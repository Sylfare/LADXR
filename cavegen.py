from locations.items import *
from logic.requirements import OR, AND
import math


DIR_X = {"up": 0, "down": 0, "left": -1, "right": 1}
DIR_Y = {"up": -1, "down": 1, "left": 0, "right": 0}
DIR_MIRROR = {"up": "down", "down": "up", "left": "right", "right": "left"}
TILE_FLOOR = 0x0D
TILE_UPPER = 0x0D
TILE_WALL_L = 0x23
TILE_WALL_R = 0x24
TILE_WALL_U = 0x21
TILE_WALL_D = 0x22
TILE_CONNECTIONS = {
    "up": [x for x in range(1, 9)],
    "down": [x+70 for x in range(1, 9)],
    "left": [y*10 for y in range(1, 7)],
    "right": [9+y*10 for y in range(1, 7)],
}
WALL_TILE = {
    "up": TILE_WALL_U,
    "down": TILE_WALL_D,
    "left": TILE_WALL_L,
    "right": TILE_WALL_R,
}
OPEN_DOOR_TILES = {
    "up": [0x43, 0x44],
    "down": [0x8C, 0x08],
    "left": [0x09, 0x0A],
    "right": [0x0B, 0x0C],
}
CLOSED_DOOR_TILES = {
    "up": [0x35, 0x36],
    "down": [0x37, 0x38],
    "left": [0x39, 0x3A],
    "right": [0x3B, 0x3C],
}
BOMB_WALL_TILE = {
    "up": 0x3F,
    "down": 0x40,
    "left": 0x41,
    "right": 0x42,
}
OPENING_TILES = {
    "up": [0x29, 0x2A],
    "down": [0x2B, 0x2C],
    "left": [0x29, 0x2B],
    "right": [0x2A, 0x2C],
}
OPENING_TILES_ALT = {
    "up": [TILE_WALL_L, TILE_WALL_R],
    "down": [TILE_WALL_L, TILE_WALL_R],
    "left": [TILE_WALL_U, TILE_WALL_D],
    "right": [TILE_WALL_U, TILE_WALL_D],
}
OPENING_FLOOR_TILES = {5, 13, 15}
TILE_TILESETS = {
    0xA3: [0x03, 0x0B, 0x0E],
    0xCB: [0x05, 0x0B, 0x0C],
    0x4E: [0x0C],
    0xDD: [0x05],
}
TILE_ANIMATION_SET = {
    0x0E: [3, 10, 11, 12],
    0x1B: [3, 11, 12],
    0xAB: [4, 6, 7],
    0xAC: [4, 6, 7],
    0xC7: [4, 7, 12],
    0xC8: [4, 7, 12],
    0xC9: [4, 7, 12],
    0xCA: [4, 7, 12],
}

class RoomTemplate:
    BOMB_WALL_TILES = {0x3F, 0x40, 0x41, 0x42, 0x47, 0x48, 0x49, 0x4A}
    def __init__(self, *, name, user, logic=None, entities=None, tiles, event=0):
        self.name = name
        self.user = user
        self.logic = logic
        self.type = "normal"
        self.entities = entities
        self.tiles = tiles
        self.event = event
        self.specific_doors = {}
        for d in DIR_MIRROR.keys():
            if self._check_any_edge_tiles(d, {-1,}):
                continue
            for idx in range(len(TILE_CONNECTIONS[d])-1):
                if self.tiles[TILE_CONNECTIONS[d][idx]] in self.BOMB_WALL_TILES:
                    self.specific_doors[d] = ('bomb', idx, 1)
            if d not in self.specific_doors:
                for idx in range(len(TILE_CONNECTIONS[d])-1):
                    if self.tiles[TILE_CONNECTIONS[d][idx]] == OPEN_DOOR_TILES[d][0] and self.tiles[TILE_CONNECTIONS[d][idx+1]] == OPEN_DOOR_TILES[d][1]:
                        self.specific_doors[d] = ('door', idx, 2)
            if d not in self.specific_doors:
                for idx in range(len(TILE_CONNECTIONS[d])-2):
                    if self.tiles[TILE_CONNECTIONS[d][idx]] in {OPENING_TILES[d][0], OPENING_TILES_ALT[d][0]} and self.tiles[TILE_CONNECTIONS[d][idx+1]] in OPENING_FLOOR_TILES:
                        s = 2
                        while idx + s < len(TILE_CONNECTIONS[d]) - 1 and self.tiles[TILE_CONNECTIONS[d][idx+s]] in OPENING_FLOOR_TILES:
                            s += 1
                        if self.tiles[TILE_CONNECTIONS[d][idx+s]] in {OPENING_TILES[d][1], OPENING_TILES_ALT[d][1]}:
                            self.specific_doors[d] = ('opening', idx, s+1)

            if d not in self.specific_doors:
                # if self._check_any_edge_tiles(d, OPENING_FLOOR_TILES):
                #     print("What?", self.name, d)
                self.specific_doors[d] = None
        if 0xA0 in self.tiles:
            self.type = "chest"
        if 0xA3 in self.tiles or 0xBE in self.tiles or 0xCB in self.tiles:
            if self.entities:
                self.type = "stairs-danger"
            else:
                self.type = "stairs"
        if self.event == 0x61:
            self.type = "chest"
        elif self.event == 0x81:
            self.type = "item"

    
    def match_room_type(self, room_type):
        if room_type == "reward":
            return self.type in {"chest", "item"}
        if room_type == "start":
            return self.type == "stairs"
        if room_type == "end":
            return self.type in {"stairs", "stairs-danger"}
        return self.type == "normal"

    def has_choice(self, direction):
        return direction not in self.specific_doors

    def can_be_open(self, direction):
        return direction not in self.specific_doors or self.specific_doors[direction] is not None

    def can_be_closed(self, direction):
        return direction not in self.specific_doors or self.specific_doors[direction] is None

    def can_be_connected_to(self, target_template, direction):
        return len(self.possible_door_positions(target_template, direction)) > 0
    
    def possible_door_positions(self, target_template, direction, size=1):
        if direction in self.specific_doors:
            my_door = self.specific_doors[direction]
            if my_door == None:
                return []
            if DIR_MIRROR[direction] in target_template.specific_doors:
                other_door = target_template.specific_doors[DIR_MIRROR[direction]]
                if my_door == other_door:
                    return [my_door]
                return []
            for n in range(my_door[2]):
                if target_template.tiles[TILE_CONNECTIONS[DIR_MIRROR[direction]][n+my_door[1]]] != -1:
                    return []
            return [my_door]
        if DIR_MIRROR[direction] in target_template.specific_doors:
            other_door = target_template.specific_doors[DIR_MIRROR[direction]]
            if other_door == None:
                return []
            for n in range(other_door[2]):
                if self.tiles[TILE_CONNECTIONS[direction][n+other_door[1]]] != -1:
                    return []
            return [other_door]
        result = []
        overlap = 0
        for idx, (s, d) in enumerate(zip(TILE_CONNECTIONS[direction], TILE_CONNECTIONS[DIR_MIRROR[direction]])):
            if self.tiles[s] == -1 and target_template.tiles[d] == -1:
                overlap += 1
                if overlap == size:
                    overlap -= 1
                    result.append(idx - overlap)
            else:
                overlap = 0
        return result

    def _check_any_edge_tiles(self, direction, check_set):
        for n in TILE_CONNECTIONS[direction]:
            if self.tiles[n] in check_set:
                return True
        return False


ROOM_TEMPLATES = [
    RoomTemplate(name='Basic Boring Empty', user='Daid', entities=[], tiles=[37,-1,-1,-1,-1,-1,-1,-1,-1,38,-1,5,5,5,5,5,5,5,5,-1,-1,5,5,5,5,5,5,5,5,-1,-1,5,5,5,5,5,5,5,5,-1,-1,5,5,5,5,5,5,5,5,-1,-1,5,5,5,5,5,5,5,5,-1,-1,5,5,5,5,5,5,5,5,-1,39,-1,-1,-1,-1,-1,-1,-1,-1,40]), # 5
    RoomTemplate(name='Snakes', user='Daid', entities=[(3,2,161),(6,4,161),(2,5,161)], tiles=[37,-1,-1,-1,-1,-1,-1,-1,-1,38,-1,5,5,5,5,5,5,5,5,-1,-1,5,13,13,5,5,5,13,5,-1,-1,5,13,13,5,5,13,5,5,-1,-1,5,5,13,5,5,13,5,5,-1,-1,5,5,13,13,13,5,5,5,-1,-1,5,5,5,5,5,5,5,5,-1,39,-1,-1,-1,-1,-1,-1,-1,-1,40]), # 6
    RoomTemplate(name='River Crossing Horizontal', user='Daid', logic=OR(FLIPPERS, AND(FEATHER, PEGASUS_BOOTS)), entities=[(3,3,153),(6,4,153)], tiles=[37,-1,-1,-1,-1,-1,-1,-1,-1,38,35,27,27,5,5,5,5,27,27,36,35,14,14,27,27,27,27,14,14,36,35,14,14,14,14,14,14,14,14,36,35,14,14,14,14,14,14,14,14,36,35,14,14,27,27,27,27,14,14,36,35,27,27,5,5,5,5,27,27,36,39,-1,-1,-1,-1,-1,-1,-1,-1,40]), # 9
    RoomTemplate(name='River Crossing Vertical', user='Daid', logic=OR(FLIPPERS, AND(FEATHER, PEGASUS_BOOTS)), entities=[(4,2,153),(5,5,153)], tiles=[37,33,33,33,33,33,33,33,33,38,-1,5,27,14,14,14,14,27,5,-1,-1,5,13,27,14,14,27,5,5,-1,-1,5,5,27,14,14,27,5,5,-1,-1,5,5,27,14,14,27,5,5,-1,-1,5,5,27,14,14,27,13,5,-1,-1,5,27,14,14,14,14,27,5,-1,39,34,34,34,34,34,34,34,34,40]), # 10
    RoomTemplate(name='Slimes', user='Daid', entities=[(3,2,27),(7,3,155),(6,4,27),(3,5,155)], tiles=[37,-1,-1,-1,-1,-1,-1,-1,-1,38,-1,5,5,5,5,5,5,5,5,-1,-1,5,5,15,5,5,5,5,5,-1,-1,5,5,5,5,5,5,15,5,-1,-1,5,5,5,5,5,15,5,5,-1,-1,5,5,15,5,5,5,5,5,-1,-1,5,5,5,5,5,5,5,5,-1,39,-1,-1,-1,-1,-1,-1,-1,-1,40]), # 11
    RoomTemplate(name='Pots&Skels', user='Daid', entities=[(6,3,26),(3,4,30)], tiles=[37,33,-1,-1,-1,-1,-1,-1,33,38,35,5,5,5,5,5,5,5,5,36,-1,5,5,5,13,13,5,5,5,-1,-1,5,13,13,32,32,13,13,5,-1,-1,5,13,13,32,32,13,13,5,-1,-1,5,5,5,13,13,5,5,5,-1,35,5,5,5,5,5,5,5,5,36,39,34,-1,-1,-1,-1,-1,-1,34,40]), # 12
    RoomTemplate(name='cracked floor bats', user='LuckwurstJoe', logic=FEATHER, entities=[(5,4,25),(1,6,25),(2,6,25)], tiles=[37,33,33,33,33,33,33,33,33,38,35,175,175,223,174,174,223,175,175,36,35,1,1,44,34,34,43,1,223,36,-1,223,1,36,37,33,41,1,1,36,-1,223,1,36,35,1,1,1,1,36,35,1,1,36,35,1,1,1,223,36,35,176,176,36,35,223,223,176,176,36,39,34,34,40,39,-1,-1,34,34,40]), # 13
    RoomTemplate(name='Moblin Prison', user='le_becc', logic=BOMB, entities=[(5,2,27),(6,5,20)], tiles=[37,33,33,33,-1,-1,33,-1,-1,38,35,15,5,169,5,5,167,5,5,36,35,5,5,166,13,5,167,5,15,36,39,43,5,166,5,5,167,5,44,40,37,41,5,166,19,19,166,19,42,38,35,172,5,5,5,13,5,5,172,36,35,32,5,5,5,5,5,5,5,36,39,34,34,34,-1,-1,-1,-1,-1,40]), # 16
    RoomTemplate(name='Chest on the Ledge', user='le_becc', entities=[(3,2,25),(8,2,153),(7,6,153)], tiles=[37,-1,-1,38,160,37,33,33,33,38,35,5,5,36,223,35,14,14,14,36,35,13,5,36,223,35,14,14,14,36,35,221,5,36,223,35,27,27,27,-1,35,13,5,36,223,35,27,27,27,-1,35,5,5,42,152,41,27,27,27,-1,35,5,5,5,5,13,27,27,27,-1,39,-1,-1,34,34,34,34,34,34,40]), # 17
    RoomTemplate(name='Vire Pit', user='le_becc', logic=HOOKSHOT, entities=[(4,1,189),(5,3,189),(4,5,189)], tiles=[37,33,33,33,33,33,33,33,33,38,35,172,13,1,1,1,1,13,172,36,-1,223,5,1,1,1,1,5,5,-1,-1,13,5,1,1,1,1,223,5,-1,-1,5,223,1,1,1,1,5,223,-1,-1,5,5,1,1,1,1,13,5,-1,35,172,13,1,1,1,1,5,172,36,39,34,34,34,34,34,34,34,34,40]), # 18
    RoomTemplate(name='Pot Storeroom', user='le_becc', logic=POWER_BRACELET, entities=[(7,3,155),(2,4,156)], tiles=[37,33,33,33,33,33,33,-1,-1,38,35,32,32,16,160,32,17,32,32,36,41,32,32,16,32,32,17,32,32,36,5,5,5,5,5,5,5,5,5,36,5,5,5,5,5,5,5,5,5,36,43,32,32,16,32,32,17,32,32,36,35,32,32,16,32,32,17,32,32,36,39,34,34,34,34,34,34,-1,-1,40]), # 19
    RoomTemplate(name='The Pit', user='le_becc', entities=[(5,1,20),(8,2,11),(1,5,11),(5,5,155)], tiles=[37,-1,-1,199,-1,-1,199,-1,-1,38,35,5,5,5,5,5,5,5,5,36,201,5,37,152,33,33,33,38,5,202,-1,5,35,223,13,15,223,36,5,-1,-1,5,35,13,223,223,13,36,5,-1,201,5,35,223,13,5,190,36,5,202,35,5,39,34,34,34,34,40,5,36,39,-1,34,34,34,34,34,34,-1,40]), # 20
    RoomTemplate(name='Hotdog Ravine', user='Neonesque', logic=HOOKSHOT, entities=[(4,2,26),(5,4,27)], tiles=[37,33,41,37,-1,-1,33,33,33,38,35,172,5,35,13,5,44,34,34,36,-1,5,5,35,15,13,36,5,160,36,-1,5,5,35,13,13,36,5,5,-1,35,166,5,35,13,15,36,5,5,-1,35,33,152,41,13,13,36,5,172,36,35,223,223,5,5,13,42,33,33,36,39,34,-1,-1,-1,-1,34,34,34,40]), # 21
    RoomTemplate(name='Three Storeys', user='le_becc', logic=AND(SWORD, OR(FEATHER, HOOKSHOT)), entities=[(7,3,13),(2,4,13)], tiles=[33,33,33,33,33,33,-1,-1,-1,33,171,13,5,5,174,174,5,5,5,171,33,33,152,33,33,33,33,33,33,33,223,17,5,223,5,5,5,13,16,223,223,17,13,5,5,13,5,5,16,223,37,33,33,33,33,33,33,152,33,38,35,5,5,13,221,221,13,5,15,36,39,-1,-1,-1,34,34,34,34,34,40]), # 23
    RoomTemplate(name='Crystal Overpass', user='Neonesque', logic=AND(SWORD, PEGASUS_BOOTS, HOOKSHOT), entities=[(8,0,25),(6,4,25),(8,5,25)], tiles=[37,33,33,33,-1,-1,33,33,33,38,35,223,13,167,13,13,221,15,13,36,35,34,43,167,167,167,44,34,34,36,-1,5,35,13,221,223,36,5,5,36,-1,5,35,13,221,13,36,5,166,36,35,152,41,223,221,13,42,33,33,36,35,5,13,13,13,13,13,223,13,36,39,-1,-1,-1,-1,-1,-1,-1,-1,40]), # 25
    RoomTemplate(name='Narrow Creek Bombable', user='Neonesque', logic=BOMB, entities=[(6,2,156),(8,3,153),(6,5,153)], tiles=[37,-1,-1,38,223,37,33,-1,-1,38,35,13,5,36,13,35,32,5,13,36,-1,27,27,42,33,41,13,27,27,-1,-1,5,27,27,169,27,27,27,27,-1,-1,5,13,44,34,43,27,27,27,-1,-1,13,5,36,13,35,27,27,5,-1,35,5,5,36,223,35,27,13,32,36,39,-1,-1,40,13,39,-1,-1,34,40]), # 26
    RoomTemplate(name='Narrow Creek Crystal', user='Neonesque', logic=SWORD, entities=[(6,2,156),(8,3,153),(6,5,153)], tiles=[37,-1,-1,38,223,37,33,-1,-1,38,35,13,5,36,13,35,32,5,13,36,-1,27,27,42,33,41,13,27,27,-1,-1,5,27,27,221,27,27,27,27,-1,-1,5,13,44,34,43,27,27,27,-1,-1,13,5,36,13,35,27,27,5,-1,35,5,5,36,223,35,27,13,32,36,39,-1,-1,40,13,39,-1,-1,34,40]), # 27
    RoomTemplate(name='Lurker\'s Maze', user='Neonesque', entities=[(4,3,236),(1,6,236)], tiles=[37,-1,-1,-1,-1,-1,-1,33,33,38,-1,13,13,223,13,5,13,160,13,36,-1,13,44,43,171,5,167,167,167,36,-1,5,42,41,5,13,167,13,13,-1,-1,5,13,44,43,171,167,5,5,-1,-1,171,15,42,41,5,167,13,223,-1,35,13,13,13,5,5,44,34,34,40,39,34,-1,-1,-1,-1,40,223,13,13]), # 28
    RoomTemplate(name='Generic Cave Room', user='Neonesque', entities=[(8,1,159),(3,2,35),(2,4,159),(6,5,159)], tiles=[37,-1,-1,-1,-1,-1,-1,33,33,38,-1,5,5,5,223,13,13,15,13,36,-1,5,13,5,44,34,34,43,13,36,-1,5,223,5,36,13,223,35,5,-1,-1,5,223,223,42,33,33,41,223,-1,-1,13,5,223,5,5,5,13,223,-1,-1,5,5,5,5,13,5,5,5,-1,39,-1,-1,-1,-1,-1,-1,-1,-1,40]), # 29
    RoomTemplate(name='Water Parkour', user='Neonesque', logic=OR(FLIPPERS,FEATHER), entities=[(7,2,153),(5,3,160),(2,4,153),(6,5,153)], tiles=[37,-1,-1,33,33,-1,-1,-1,33,38,-1,27,27,14,14,14,27,14,14,36,-1,27,27,14,14,14,14,14,27,-1,-1,27,27,14,27,27,14,14,27,-1,35,14,14,14,27,27,14,14,27,-1,35,14,14,14,14,14,14,14,27,-1,35,14,27,27,27,27,14,14,14,36,39,34,-1,-1,-1,-1,34,34,34,40]), # 30
    RoomTemplate(name='Haunted Chapel', user='le_becc', logic=BOMB, entities=[(7,1,18),(6,5,18),(3,6,18)], tiles=[37,33,199,33,199,33,199,33,33,38,35,160,7,7,7,7,7,7,7,36,35,169,7,166,7,166,7,166,7,-1,35,171,7,7,7,7,7,7,7,-1,35,171,7,7,7,7,7,7,7,-1,35,166,7,166,7,166,7,166,7,-1,-1,7,7,7,7,7,7,7,7,36,39,34,200,34,200,34,200,34,34,40]), # 32
    RoomTemplate(name='The Bridge', user='le_becc', logic=FEATHER, entities=[(7,3,44),(2,4,44)], tiles=[35,1,1,1,1,1,1,1,1,36,35,1,1,1,1,1,1,1,1,36,35,1,1,1,1,1,1,1,1,36,9,5,5,5,1,223,5,5,223,11,10,223,13,5,223,1,5,13,5,12,35,1,1,1,1,1,1,1,1,36,35,1,1,1,1,1,1,1,1,36,35,1,1,1,1,1,1,1,1,36]), # 33
    RoomTemplate(name='4 wizrobe torches crossroad', user='dragonc0', entities=[(3,2,33),(6,2,33),(3,5,33),(6,5,33)], tiles=[37,33,199,33,33,33,33,199,33,38,-1,5,166,5,32,32,5,166,5,-1,-1,5,5,5,13,13,5,5,5,-1,-1,5,32,13,172,172,13,32,5,-1,-1,5,32,13,172,172,13,32,5,-1,-1,5,5,5,13,13,5,5,5,-1,-1,5,166,5,32,32,5,166,5,-1,39,34,200,34,34,34,34,200,34,40]), # 34
    RoomTemplate(name='Slinky Waterway Passage', user='dragonc0', logic=FLIPPERS, entities=[(6,3,153),(2,4,153),(7,4,160),(5,5,160)], tiles=[37,33,33,33,-1,-1,-1,-1,38,13,-1,27,166,166,27,27,27,27,42,38,-1,27,166,14,14,166,14,14,166,36,-1,27,14,14,166,14,14,166,27,-1,-1,27,14,14,166,14,14,14,27,-1,-1,27,14,166,166,14,14,166,27,-1,-1,27,27,27,166,166,27,27,44,40,39,-1,-1,-1,34,34,-1,-1,40,13]), # 36
    RoomTemplate(name='Owl Guardian Trial', user='dragonc0', logic=AND(BOMB, POWER_BRACELET, SWORD, OR(AND(FLIPPERS, PEGASUS_BOOTS, FEATHER), HOOKSHOT)), tiles=[37,-1,-1,166,160,166,-1,-1,-1,38,-1,5,13,192,152,192,5,5,13,-1,-1,13,32,166,14,192,32,192,13,-1,35,166,221,192,175,192,221,166,192,36,35,192,221,192,1,166,221,192,166,36,35,166,221,192,176,192,221,166,192,36,35,192,5,169,13,169,5,192,44,40,39,34,34,34,34,34,34,34,40,13]), # 39
    RoomTemplate(name='You ran too much', user='LuckwurstJoe', logic=AND(PEGASUS_BOOTS, FEATHER, HOOKSHOT), tiles=[37,33,33,33,33,33,33,33,33,38,35,174,174,174,32,32,174,174,174,36,39,34,34,43,5,15,44,34,34,40,-1,5,78,35,5,5,36,5,166,-1,-1,5,78,35,5,5,36,5,5,-1,37,152,33,41,5,13,42,33,33,38,35,5,5,5,13,5,174,174,174,36,39,34,34,34,34,34,34,34,34,40]), # 40
    RoomTemplate(name='Four Zol Guardians Crossroads', user='dragonc0', logic=OR(FLIPPERS, FEATHER, POWER_BRACELET, PEGASUS_BOOTS, HOOKSHOT), entities=[(4,3,28),(5,3,28),(4,4,28),(5,4,28)], tiles=[13,37,-1,-1,-1,-1,-1,-1,38,223,37,41,13,13,5,13,13,5,42,38,-1,5,13,192,192,160,192,13,13,-1,-1,13,15,78,13,13,14,5,5,-1,-1,5,13,14,13,5,32,5,13,-1,-1,13,13,166,174,174,166,15,13,-1,39,43,13,13,15,5,13,13,44,40,223,39,-1,-1,-1,-1,-1,-1,40,13]), # 41
    RoomTemplate(name='Mini Dream Shrine', user='dragonc0', logic=AND(PEGASUS_BOOTS, OR(BOOMERANG, HOOKSHOT, FEATHER, SWORD)), entities=[(2,1,40),(3,1,40),(7,1,40),(1,2,40),(8,3,40),(8,4,40),(1,5,40),(8,5,40)], tiles=[37,33,33,33,33,33,33,33,33,38,35,5,5,15,5,5,5,5,5,36,35,5,44,34,34,34,34,43,5,36,35,5,36,23,18,160,22,35,15,36,35,15,36,17,15,5,16,35,5,36,35,5,42,33,33,152,33,41,5,36,35,5,5,5,172,5,78,5,5,36,39,-1,-1,-1,34,34,34,34,34,40]), # 42
    RoomTemplate(name='Possible Start Room', user='Daid', tiles=[13,37,-1,-1,-1,-1,-1,-1,-1,38,37,41,5,5,5,5,5,5,223,-1,-1,5,5,13,13,5,5,5,5,-1,-1,5,13,32,32,203,5,5,5,-1,-1,5,13,32,32,13,5,5,5,-1,-1,5,5,13,13,5,5,5,15,-1,-1,5,5,5,5,5,5,15,15,-1,39,-1,-1,-1,-1,-1,-1,-1,-1,40]), # 43
    RoomTemplate(name='Beamos Spiral Treasure', user='dragonc0', entities=[(1,1,28),(8,1,28),(2,2,28),(7,2,28),(4,4,42),(7,5,28),(2,6,28),(8,6,28)], tiles=[37,-1,-1,-1,-1,-1,-1,-1,-1,38,-1,5,19,19,19,19,19,19,5,-1,-1,16,5,19,19,19,19,5,17,-1,-1,16,16,5,19,5,160,17,17,-1,-1,16,16,16,13,17,5,17,17,-1,-1,16,16,5,18,18,18,5,17,-1,-1,16,5,18,18,18,18,18,5,-1,39,-1,-1,-1,-1,-1,-1,-1,-1,40]), # 45
    RoomTemplate(name='Mind the Gap', user='MuffinJets', logic=OR(FLIPPERS, HOOKSHOT, AND(FEATHER, PEGASUS_BOOTS)), entities=[(3,3,44),(2,4,44)], tiles=[37,33,33,33,33,33,33,33,33,38,35,5,5,5,5,175,175,5,166,36,-1,5,5,5,5,1,1,5,5,-1,-1,5,5,5,5,1,1,5,5,-1,-1,5,5,5,5,1,1,5,5,-1,-1,5,5,5,5,1,1,5,5,-1,35,5,5,166,5,176,176,5,5,36,39,34,34,34,34,34,34,34,34,40]), # 46
    RoomTemplate(name='Swamp Crossroads', user='dragonc0', logic=OR(FEATHER, FLIPPERS), entities=[(4,1,126),(2,2,126),(4,3,126),(7,3,126),(8,3,126),(5,4,126),(2,5,126),(7,6,126)], tiles=[37,-1,-1,-1,33,-1,-1,-1,-1,38,-1,14,27,27,14,14,27,27,14,-1,-1,27,14,27,14,27,27,14,27,-1,-1,27,14,27,14,14,27,14,14,36,-1,27,14,14,14,14,14,27,14,-1,-1,27,14,27,14,27,27,14,27,-1,-1,14,27,14,27,14,27,27,14,-1,39,-1,-1,-1,-1,-1,-1,34,34,40]), # 47
    RoomTemplate(name='Wait, I\'ve seen that one before!', user='MuffinJets', event=0x61, entities=[(3,3,30),(4,6,24),(7,6,25)], tiles=[37,33,33,33,33,33,-1,-1,-1,38,35,5,32,32,5,5,5,5,5,36,35,5,32,5,5,5,5,5,13,36,35,5,5,5,5,5,5,5,5,36,35,5,5,5,167,167,5,5,5,36,35,5,5,166,7,7,166,5,5,36,35,172,5,166,7,7,166,5,172,36,39,34,34,34,34,34,34,34,34,40]), # 48
    RoomTemplate(name='Something Something Jesus Jump', user='MuffinJets', logic=FLIPPERS, entities=[(4,1,204),(3,3,204),(6,4,204),(5,6,204)], tiles=[37,-1,-1,-1,-1,-1,-1,-1,-1,38,-1,14,14,14,14,14,14,14,14,-1,-1,166,166,166,166,166,166,166,14,-1,-1,14,14,14,14,14,166,166,14,-1,-1,14,166,166,14,14,14,14,14,-1,-1,14,166,166,166,166,166,166,166,-1,-1,14,14,14,14,14,14,14,14,-1,39,-1,-1,-1,-1,-1,-1,-1,-1,40]), # 49
    RoomTemplate(name='Gopongo Cave', user='Neonesque', logic=OR(MAGIC_ROD, BOOMERANG, HOOKSHOT), entities=[(6,2,126),(1,3,124),(7,5,126),(2,6,126)], tiles=[37,-1,-1,-1,-1,-1,-1,-1,-1,38,35,5,5,5,5,5,13,13,5,36,201,5,13,5,13,5,5,5,5,36,35,5,13,44,34,34,34,34,34,36,35,13,13,36,5,5,5,13,5,202,201,13,5,42,152,38,5,13,5,36,35,13,5,5,5,36,13,5,5,202,39,34,34,34,34,34,-1,-1,-1,40]), # 50
    RoomTemplate(name='Don\'t Stand So Close to Me', user='MuffinJets', entities=[(2,1,82),(4,1,82),(5,1,82),(7,1,82),(2,6,83),(4,6,83),(5,6,83),(7,6,83)], tiles=[13,37,33,33,33,33,33,33,38,223,37,41,174,174,174,174,174,174,42,38,-1,5,5,5,5,5,5,15,5,-1,-1,13,15,5,5,5,5,5,5,-1,-1,5,13,5,5,5,5,5,5,-1,-1,13,13,15,5,5,5,5,5,-1,39,43,174,174,174,174,174,174,44,40,223,39,34,34,34,34,34,34,40,13]), # 51
    RoomTemplate(name='The Worse Bridge', user='MuffinJets', logic=AND(PEGASUS_BOOTS, FEATHER), tiles=[35,1,1,1,1,1,1,1,1,36,35,166,1,1,1,1,1,1,166,36,-1,5,166,166,166,166,166,166,223,-1,-1,5,5,223,1,78,223,5,223,-1,-1,223,13,223,78,1,223,13,5,-1,-1,223,166,166,166,166,166,166,5,-1,35,166,1,1,1,1,1,1,166,36,35,1,1,1,1,1,1,1,1,36]), # 52
    RoomTemplate(name='Flower Crossroads', user='le_becc', logic=OR(MAGIC_ROD, BOOMERANG, HOOKSHOT), entities=[(1,1,25),(4,3,124),(7,6,25)], tiles=[5,223,5,37,-1,-1,38,223,13,5,13,13,223,35,27,27,36,13,15,223,37,33,33,41,27,27,42,33,33,38,-1,27,27,27,27,27,27,27,27,-1,-1,27,27,27,27,27,27,27,27,-1,39,34,34,43,27,27,44,34,34,40,13,5,223,35,27,27,36,5,223,13,5,223,13,39,-1,-1,40,13,5,223]), # 56
    RoomTemplate(name='Blade Trap Puzzle', user='Neonesque', logic=AND(BOMB,HOOKSHOT,FEATHER), entities=[(5,2,39),(4,4,159),(6,5,178)], tiles=[37,67,68,33,33,33,33,33,33,38,35,5,5,35,5,13,15,36,5,36,35,5,13,35,174,5,174,36,167,36,35,167,18,35,13,169,5,42,152,36,35,5,5,35,13,5,13,174,5,-1,35,152,33,41,13,5,174,5,5,-1,35,13,5,174,5,5,5,13,5,-1,39,34,34,34,-1,-1,-1,-1,-1,40]), # 57
    RoomTemplate(name='Vertical Ball and Chain Gauntlet', user='dragonc0', logic=SWORD, entities=[(3,2,81),(6,2,81),(3,5,81),(6,5,81)], tiles=[37,33,33,33,-1,-1,33,33,33,38,35,23,22,18,17,16,18,23,22,36,35,17,13,5,17,16,5,13,16,36,35,17,13,25,17,16,26,13,16,36,35,17,13,26,17,16,25,13,16,36,35,17,13,5,17,16,5,13,16,36,35,21,20,19,17,16,19,21,20,36,39,34,34,34,-1,-1,34,34,34,40]), # 58
    RoomTemplate(name='Horizontal Ball and Chain Gauntlet', user='dragonc0', logic=SWORD, entities=[(2,2,81),(7,2,81),(2,5,81),(7,5,81)], tiles=[37,33,33,33,33,33,33,33,33,38,35,23,18,18,18,18,18,18,22,36,35,17,5,25,18,18,26,5,16,36,-1,18,18,18,18,18,18,18,18,-1,-1,19,19,19,19,19,19,19,19,-1,35,17,5,26,19,19,25,5,16,36,35,21,19,19,19,19,19,19,20,36,39,34,34,34,34,34,34,34,34,40]), # 59
    RoomTemplate(name='Zora Surprise Crossroads With Chest', user='dragonc0', logic=OR(FLIPPERS, FEATHER), entities=[(2,2,203),(4,2,203),(5,2,203),(7,2,203),(2,5,203),(4,5,203),(5,5,203),(7,5,203)], tiles=[37,-1,-1,-1,-1,-1,-1,-1,-1,38,-1,5,13,5,13,5,5,5,13,-1,-1,5,14,14,14,14,14,14,13,-1,-1,5,14,13,15,15,160,14,5,-1,-1,13,14,13,15,15,13,14,5,-1,-1,5,14,14,14,14,14,14,5,-1,-1,5,13,5,5,13,13,13,13,-1,39,-1,-1,-1,-1,-1,-1,-1,-1,40]), # 60
    RoomTemplate(name='Sword Dash Required', user='Matty', logic=AND(PEGASUS_BOOTS, SWORD), entities=[(2,5,83)], tiles=[37,38,13,13,223,13,13,5,37,38,35,42,33,199,33,33,199,33,41,36,35,13,160,13,166,166,166,166,5,-1,35,167,167,167,5,221,5,5,5,-1,35,5,5,5,5,221,5,5,5,-1,35,5,5,5,5,221,5,5,5,-1,35,44,34,200,34,34,200,34,43,36,39,40,13,223,13,13,223,13,39,40]), # 61
    RoomTemplate(name='Say Hi to Your Fans!', user='Matty', entities=[(1,5,31),(2,5,236),(5,5,237),(6,5,24),(8,5,238),(4,6,31),(7,6,24),(2,7,24)], tiles=[37,199,33,33,33,33,33,33,199,38,-1,5,5,5,13,5,5,5,5,-1,-1,5,13,5,5,5,13,5,5,-1,35,172,19,19,19,19,19,19,172,36,35,33,199,33,33,33,33,199,33,36,35,5,5,13,5,5,5,13,5,36,35,5,13,15,5,5,5,5,5,36,35,5,5,5,13,5,13,5,15,36]), # 62
    RoomTemplate(name='Boot Chain Puzzle', user='Neonesque', logic=AND(PEGASUS_BOOTS, BOMB), entities=[(4,4,42)], tiles=[37,-1,-1,-1,-1,-1,-1,-1,-1,38,35,19,19,19,19,19,19,19,5,36,35,78,223,223,223,223,223,223,78,36,35,223,23,13,13,13,13,18,44,40,35,223,13,5,5,5,5,5,42,38,35,223,21,13,13,18,22,5,5,-1,35,78,223,223,223,169,16,5,5,-1,39,34,34,34,34,34,34,-1,-1,40]), # 63
    RoomTemplate(name='One of THOSE Puzzles', user='Matty', logic=AND(BOMB, OR(HOOKSHOT, PEGASUS_BOOTS)), tiles=[37,166,33,33,33,33,33,33,33,38,35,5,13,5,5,5,5,13,5,36,35,175,175,166,18,18,18,166,78,36,35,1,1,166,169,160,169,166,78,36,35,1,1,166,167,167,167,5,78,36,35,176,176,13,5,5,5,167,5,36,-1,5,5,5,5,13,5,167,13,36,39,34,166,-1,-1,-1,-1,34,34,40]), # 65
    RoomTemplate(name='This is Why Mom Said I Can\'t Play Mario Maker Anymore', user='Matty', logic=BOMB, entities=[(3,3,176),(5,3,176),(4,4,176),(6,4,176)], tiles=[37,-1,-1,33,33,33,33,33,33,38,35,19,5,19,19,16,17,19,5,36,35,169,19,21,20,19,19,17,19,36,-1,5,17,175,175,175,175,21,5,-1,-1,5,22,176,176,176,176,16,5,-1,35,18,16,18,18,23,22,18,169,36,35,5,18,16,17,18,18,5,18,36,39,34,34,34,34,34,34,-1,-1,40]), # 66
    RoomTemplate(name='Have Fun', user='Matty', logic=FEATHER, entities=[(3,3,32),(6,4,32)], tiles=[37,-1,-1,-1,-1,-1,-1,-1,-1,38,-1,5,5,5,5,5,5,5,5,-1,-1,5,175,174,174,174,174,175,5,-1,-1,5,1,5,5,160,5,1,5,-1,-1,5,1,5,5,5,5,1,5,-1,-1,5,176,174,174,174,174,176,5,-1,-1,5,5,5,5,5,5,5,5,-1,39,-1,-1,-1,-1,-1,-1,-1,-1,40]), # 67
    RoomTemplate(name='Mini Moldorm Cave', user='Darknesslink81', entities=[(4,1,41),(1,2,41),(7,3,41),(1,5,41)], tiles=[37,33,33,-1,-1,-1,-1,33,33,38,35,13,13,13,13,13,13,13,13,36,35,13,15,175,13,13,175,13,13,-1,-1,13,13,1,13,13,1,13,13,-1,-1,13,13,1,13,13,1,13,13,-1,35,13,13,176,13,13,176,13,15,-1,35,13,13,13,13,13,13,13,13,36,39,34,34,-1,-1,-1,-1,34,34,40]), # 68
    RoomTemplate(name='False Fairy', user='le_becc', entities=[(4,2,203)], tiles=[13,37,33,33,33,33,33,33,38,223,37,41,16,37,33,33,38,17,42,38,-1,13,16,35,27,27,36,17,13,-1,-1,13,16,39,34,34,40,17,13,-1,-1,13,13,18,18,18,18,13,13,-1,-1,13,192,13,13,13,13,192,13,-1,39,43,13,13,13,13,13,13,44,40,223,39,-1,-1,-1,-1,-1,-1,40,13]), # 69
    RoomTemplate(name='Bomb and Flipper Chest Room', user='Darknesslink81', logic=AND(BOMB, FLIPPERS), entities=[(5,6,204)], tiles=[37,33,38,-1,-1,-1,-1,37,33,38,35,32,36,17,13,13,16,35,32,36,-1,27,36,17,13,15,16,35,27,-1,-1,14,36,17,223,13,16,35,14,-1,-1,14,36,21,169,169,20,35,14,-1,35,14,42,33,152,152,33,41,14,36,35,14,14,14,14,14,14,14,14,36,39,34,34,-1,-1,-1,-1,34,34,40]), # 70
    RoomTemplate(name='Into Position L-R', user='Matty', logic=HOOKSHOT, entities=[(4,6,20)], tiles=[37,33,33,33,33,33,33,33,33,38,35,166,5,35,27,27,36,5,5,11,-1,5,5,35,27,15,36,5,5,12,-1,5,5,35,27,27,36,5,5,36,35,152,33,41,27,27,42,38,167,36,35,5,5,5,15,5,5,42,152,36,35,15,5,5,5,5,5,15,5,36,39,34,34,34,34,34,34,34,34,40]), # 71
    RoomTemplate(name='Mimic Boots Room', user='Darknesslink81', logic=PEGASUS_BOOTS, entities=[(1,6,40),(8,6,40)], tiles=[37,33,38,199,-1,-1,-1,199,37,38,35,32,36,17,5,5,5,16,35,36,-1,5,36,21,19,78,19,20,35,36,-1,5,42,33,33,152,33,33,41,36,-1,5,5,5,15,5,15,5,32,36,-1,13,13,5,5,5,5,5,5,36,35,18,18,22,78,78,23,18,18,36,39,34,200,34,-1,-1,34,200,34,40]), # 72
    RoomTemplate(name='A Legendary Treasure', user='Matty', tiles=[37,33,33,33,33,33,-1,-1,-1,38,35,172,5,5,5,172,5,5,5,-1,35,5,44,34,43,5,13,5,5,-1,35,5,36,160,35,5,5,5,5,-1,35,5,42,152,41,5,5,5,13,-1,35,172,5,5,15,172,13,5,5,-1,35,5,5,5,5,5,5,5,5,-1,39,34,34,34,-1,-1,-1,-1,-1,40]), # 73
    RoomTemplate(name='A Dangerous Swim', user='Matty', logic=OR(FLIPPERS, AND(PEGASUS_BOOTS, FEATHER)), entities=[(3,1,153),(2,2,203),(5,3,153),(2,4,153),(7,4,203),(6,6,153)], tiles=[37,-1,-1,33,33,33,33,-1,-1,38,-1,27,27,14,14,14,14,27,27,-1,-1,27,14,14,14,14,14,14,27,-1,35,14,14,14,27,27,14,14,14,36,35,14,14,14,27,27,14,14,14,36,-1,27,14,14,14,14,14,14,27,-1,-1,27,27,14,14,14,14,27,27,-1,39,-1,-1,34,34,34,34,-1,-1,40]), # 74
    RoomTemplate(name='Welcome to the Hell Floor', user='Matty', entities=[(2,2,189),(3,5,81),(7,5,189)], tiles=[37,-1,-1,-1,-1,-1,-1,-1,-1,38,-1,13,5,5,5,5,15,5,13,-1,-1,5,5,32,37,33,38,32,5,-1,-1,5,13,32,35,203,36,32,5,-1,-1,5,5,32,39,152,40,32,5,-1,-1,15,5,5,172,5,172,13,5,-1,-1,5,5,13,5,5,5,5,5,-1,39,-1,-1,-1,-1,-1,-1,-1,-1,40]), # 75
    RoomTemplate(name='The Thunderdome', user='Matty', entities=[(3,1,15),(6,1,15),(6,3,81),(3,6,15),(6,6,15)], tiles=[37,33,199,33,-1,-1,33,199,33,38,201,5,5,5,5,5,5,5,13,202,-1,13,37,33,152,152,33,38,13,-1,-1,5,35,15,5,13,13,36,5,-1,-1,13,35,13,15,5,15,36,5,-1,-1,5,39,34,152,152,34,40,5,-1,201,5,13,5,5,5,5,13,5,202,39,34,200,34,-1,-1,34,200,34,40]), # 76
    RoomTemplate(name='Two Small Rooms in a Trenchcoat', user='Matty', entities=[(2,3,15)], tiles=[37,-1,-1,-1,38,37,-1,-1,-1,38,-1,5,5,5,36,35,5,5,13,-1,-1,5,160,13,36,35,13,32,5,-1,-1,5,5,5,11,9,5,32,5,-1,-1,13,5,15,12,10,5,32,13,-1,-1,5,13,5,36,35,5,32,5,-1,-1,5,5,5,36,35,5,13,5,-1,39,-1,-1,-1,40,39,-1,-1,-1,40]), # 77
    RoomTemplate(name='The Wrong Neighborhood', user='Matty', entities=[(4,1,238),(6,1,237),(3,2,236),(5,3,237),(4,4,238),(3,5,237),(6,5,236),(5,6,238)], tiles=[5,13,37,-1,-1,-1,-1,38,13,5,13,223,35,5,5,5,13,36,223,13,13,5,35,13,5,5,5,36,13,5,223,13,35,13,5,13,5,36,13,223,5,13,35,5,5,5,5,36,5,13,13,223,35,5,13,5,13,36,13,13,5,13,35,5,5,13,5,36,223,5,223,5,39,-1,-1,-1,-1,40,5,13]), # 78
    RoomTemplate(name='Simple Diagonal Jumps', user='Catobat', logic=FEATHER, tiles=[37,33,33,33,-1,-1,33,33,33,38,35,1,1,1,5,5,1,1,1,36,35,1,1,1,13,5,1,1,1,36,35,176,176,1,175,175,1,176,176,36,-1,5,5,1,1,1,1,5,13,-1,-1,5,13,1,1,1,1,5,5,-1,-1,13,13,1,1,1,1,15,5,-1,39,34,34,34,34,34,34,34,34,40]), # 79
    RoomTemplate(name='Shy Pit', user='Toast', entities=[(4,2,143),(2,3,143),(7,4,143),(5,5,143)], tiles=[37,33,33,41,5,5,42,33,33,38,35,172,174,174,223,5,174,174,171,36,35,1,223,223,223,223,223,223,1,36,35,1,223,223,175,175,223,223,1,36,35,1,223,223,176,176,223,223,1,36,35,1,223,223,223,223,223,223,1,36,35,171,174,174,5,223,174,174,172,36,39,34,34,43,5,5,44,34,34,40]), # 80
    RoomTemplate(name='Paradox Chest', user='Catobat', tiles=[37,33,33,33,33,33,33,33,33,38,35,44,43,5,160,32,5,5,37,36,35,36,39,5,5,32,5,37,41,36,35,42,33,152,37,33,152,41,5,-1,35,5,5,5,35,5,5,5,5,-1,35,33,152,33,41,34,152,34,43,36,35,5,5,5,5,5,5,38,35,36,39,-1,-1,-1,-1,-1,-1,40,39,40]), # 81
    RoomTemplate(name='Pit Parkour', user='Neonesque', logic=AND(FEATHER,OR(SWORD,PEGASUS_BOOTS)), entities=[(3,3,25)], tiles=[33,33,33,33,33,33,33,-1,-1,38,13,13,175,174,174,175,175,5,5,-1,13,5,1,5,221,1,1,13,5,-1,43,175,1,221,13,1,176,174,175,36,35,1,1,13,5,1,5,13,1,36,35,176,176,174,175,1,5,5,1,36,35,13,13,5,176,176,13,5,176,36,39,-1,-1,-1,34,34,-1,-1,34,40]), # 82
    RoomTemplate(name='Waste Pit', user='Neonesque', entities=[(1,1,27),(2,2,27),(1,3,27),(4,4,18)], tiles=[37,33,33,33,33,-1,-1,-1,-1,38,35,5,5,5,5,5,13,5,13,-1,-1,5,13,13,32,5,13,15,5,-1,-1,5,5,5,13,5,160,32,5,-1,-1,5,5,15,5,5,5,5,13,-1,-1,13,13,5,5,5,13,27,27,36,35,32,13,13,5,13,27,14,14,36,39,34,-1,-1,-1,-1,34,34,34,40]), # 83
    RoomTemplate(name='Ruined Pedestal', user='Neonesque', logic=AND(BOMB,FEATHER), entities=[(6,4,178),(5,6,176)], tiles=[37,-1,-1,-1,-1,33,33,33,33,38,35,13,13,15,13,169,167,13,5,-1,35,44,44,34,43,43,223,13,13,-1,35,36,36,169,35,35,175,174,13,-1,35,36,42,152,41,35,176,5,174,36,35,42,33,152,33,41,13,13,223,-1,35,13,223,5,13,174,5,223,13,-1,39,34,34,34,34,34,34,34,34,40]), # 84
    RoomTemplate(name='Vacuum Mouth Walkway', user='Neonesque', entities=[(2,1,27),(3,3,28),(6,3,28),(4,4,28),(6,5,83),(7,6,27)], tiles=[37,33,33,33,41,13,5,42,33,38,35,13,15,13,175,5,13,175,175,36,41,174,174,174,176,5,5,1,1,36,13,13,13,5,5,13,5,1,1,36,5,5,13,13,5,5,5,176,176,36,43,175,175,175,175,5,5,5,13,36,35,176,176,176,176,5,13,13,5,36,39,34,34,34,34,34,34,34,34,40]), # 85
    RoomTemplate(name='Goomba Passage Entrance', user='Neonesque', entities=[(1,1,159),(6,2,159),(7,4,159),(2,5,159),(8,7,159)], tiles=[223,5,13,13,5,13,37,-1,-1,38,13,13,15,223,5,37,41,5,13,-1,15,5,13,37,33,41,223,223,13,-1,37,33,33,41,13,13,13,5,5,-1,-1,13,223,5,13,203,13,5,44,40,-1,13,5,5,13,13,13,44,40,13,-1,5,13,223,44,34,34,40,223,13,39,-1,-1,-1,40,13,15,13,5,5]), # 86
    RoomTemplate(name='Raised Entrance', user='Neonesque', entities=[(3,1,44),(8,3,44),(1,6,44)], tiles=[37,-1,-1,-1,-1,-1,-1,-1,-1,38,-1,5,13,13,13,5,5,13,5,-1,-1,5,44,34,34,34,34,43,13,-1,-1,13,36,172,5,203,172,35,13,-1,-1,15,36,5,5,5,5,35,5,-1,-1,5,42,33,152,152,33,41,13,-1,-1,13,5,13,13,5,13,13,13,-1,39,-1,-1,-1,-1,-1,-1,-1,-1,40]), # 87
    RoomTemplate(name='Flooded Reward Room', user='Neonesque', logic=FLIPPERS, entities=[(5,1,153),(2,2,203),(8,3,153),(1,6,153)], tiles=[37,33,33,33,33,33,33,33,-1,38,35,14,14,14,14,14,14,14,27,36,35,14,14,44,34,34,43,14,14,36,35,14,44,40,23,160,35,14,14,36,35,14,36,13,13,13,35,14,14,36,35,14,42,152,33,33,41,14,27,-1,35,14,14,14,166,27,27,27,27,-1,39,34,34,34,34,-1,-1,-1,-1,40]), # 88
    RoomTemplate(name='Crystal Reward Room', user='Neonesque', logic=PEGASUS_BOOTS, entities=[(6,5,30),(4,6,85)], tiles=[37,33,33,33,33,33,33,38,13,223,35,15,13,13,5,13,13,42,33,38,35,5,160,16,18,18,78,18,44,40,35,13,13,16,78,13,78,13,36,15,35,18,18,18,78,18,18,18,42,38,-1,5,5,5,5,5,5,5,5,-1,-1,5,5,5,5,5,5,5,5,-1,39,-1,-1,-1,34,-1,-1,-1,-1,40]), # 89
    RoomTemplate(name='Bomb Arrow Water Puzzle', user='Neonesque', logic=AND(BOMB,BOW,OR(FLIPPERS,AND(FEATHER,PEGASUS_BOOTS))), entities=[(8,3,27),(2,5,153)], tiles=[37,-1,-1,33,33,33,33,33,33,38,-1,27,27,14,14,14,14,44,34,36,-1,27,27,14,14,169,14,36,160,36,-1,27,27,14,14,14,14,36,13,36,35,14,14,14,14,14,14,42,152,36,35,14,14,14,14,169,14,14,169,36,35,14,14,14,14,14,14,14,14,36,39,34,34,34,34,34,34,34,34,40]), # 91
    RoomTemplate(name='Goomba\'s Gift', user='Neonesque', entities=[(5,3,159)], tiles=[223,37,-1,-1,33,33,33,38,223,13,37,41,5,5,5,221,13,36,13,5,35,5,5,13,23,18,22,36,13,223,35,221,160,5,17,13,16,42,38,5,-1,13,13,5,21,19,20,221,42,38,-1,5,221,13,5,13,13,13,13,-1,39,34,34,43,5,13,221,5,13,-1,13,221,223,39,-1,-1,34,34,34,40]), # 92
    RoomTemplate(name='Unfortunate Soul', user='Neonesque', logic=FEATHER, entities=[(3,2,17)], tiles=[37,33,33,33,33,33,-1,-1,-1,38,-1,13,175,174,174,175,13,5,13,-1,-1,5,1,15,13,1,32,13,5,-1,35,175,1,13,5,1,175,13,13,-1,35,1,176,174,175,1,1,32,5,-1,35,1,32,5,176,176,176,175,175,36,35,176,13,13,5,13,5,176,176,36,39,34,-1,-1,-1,-1,-1,34,34,40]), # 93
    RoomTemplate(name='Deep Water Flower', user='le_becc', logic=OR(AND(FLIPPERS, OR(MAGIC_ROD, BOOMERANG)), HOOKSHOT), entities=[(4,3,124),(8,3,198)], tiles=[37,-1,-1,-1,38,13,13,37,33,38,-1,27,27,27,36,223,37,41,27,-1,-1,27,14,14,42,33,41,14,27,-1,-1,27,14,14,14,14,14,14,27,166,166,27,14,14,14,14,14,14,27,-1,35,14,44,34,34,43,14,14,27,-1,39,34,40,13,13,35,27,27,27,-1,13,13,13,223,13,39,-1,-1,-1,40]), # 95
    RoomTemplate(name='Some Ancient Ruins Puzzle', user='Matty', logic=AND(SWORD, BOMB, POWER_BRACELET, HOOKSHOT), tiles=[37,-1,-1,-1,-1,-1,33,33,33,38,35,13,5,13,5,13,166,166,166,36,35,5,5,13,5,5,172,190,172,36,35,33,152,38,221,167,174,32,166,36,-1,5,5,36,221,167,17,169,166,36,-1,13,5,36,221,167,174,174,166,36,-1,5,5,36,5,5,13,15,13,36,39,-1,-1,34,34,34,34,34,34,40]), # 96
    RoomTemplate(name='Hookshot Reward Room', user='Matty', logic=HOOKSHOT, entities=[(2,1,25),(8,1,25),(5,2,25),(3,4,25),(7,5,25)], tiles=[37,33,33,33,-1,-1,-1,33,33,38,35,160,5,35,5,5,5,36,5,36,35,5,13,35,13,5,13,36,5,36,35,33,33,41,5,5,5,42,152,36,-1,5,5,5,5,13,5,5,13,-1,-1,13,5,5,15,5,5,5,5,-1,-1,5,13,5,5,5,13,5,13,-1,39,-1,-1,-1,-1,-1,-1,-1,-1,40]), # 97
    RoomTemplate(name='But What if Cheating?', user='Matty', logic=AND(BOW, BOMB, HOOKSHOT), tiles=[37,33,33,33,-1,-1,-1,33,33,38,35,5,5,35,5,5,5,36,5,166,35,152,33,41,5,13,5,42,33,36,-1,5,13,5,5,5,13,5,13,-1,35,34,34,43,13,5,223,44,34,36,35,160,5,35,5,13,13,36,169,36,35,13,5,35,13,5,223,36,5,36,39,34,34,34,-1,-1,-1,34,166,40]), # 98
    RoomTemplate(name='Layer Cake', user='Matty', logic=AND(POWER_BRACELET, BOMB, SWORD), tiles=[37,33,33,33,33,33,-1,-1,-1,38,35,166,166,160,166,166,13,5,13,-1,35,166,172,221,172,166,5,5,5,-1,35,17,169,169,169,16,15,13,5,-1,35,166,167,167,167,166,5,5,5,-1,-1,5,32,32,32,5,5,13,13,-1,-1,5,13,5,5,13,5,5,5,-1,39,-1,-1,-1,-1,-1,-1,-1,-1,40]), # 99
    RoomTemplate(name='Bomb Arrow Wall', user='le_becc', logic=AND(BOMB, BOW, OR(HOOKSHOT, FEATHER)), entities=[(1,3,155),(7,3,155),(6,5,174)], tiles=[37,-1,-1,-1,33,-1,-1,-1,-1,38,-1,5,5,5,166,5,5,5,13,-1,35,13,1,1,166,1,1,5,5,-1,166,15,1,1,169,1,1,13,166,36,35,5,1,1,166,1,1,13,13,-1,-1,5,5,5,166,5,5,13,5,-1,-1,13,5,5,166,5,5,5,13,-1,39,-1,-1,-1,34,-1,-1,-1,-1,40]), # 101
    RoomTemplate(name='Dashing Pot Stairway', user='Matty', logic=AND(PEGASUS_BOOTS, POWER_BRACELET), tiles=[37,33,33,33,33,33,33,33,33,38,35,166,166,166,166,166,166,166,166,36,-1,5,78,78,78,78,78,78,166,36,-1,13,166,166,166,166,166,5,166,36,-1,5,13,27,27,166,32,32,32,36,-1,5,5,27,27,166,32,190,32,36,-1,5,13,13,5,166,32,32,32,36,39,-1,-1,-1,-1,34,34,34,34,40]), # 102
    RoomTemplate(name='Steppin\' On the Beach', user='Matty', logic=OR(SHIELD, SWORD), entities=[(2,2,238),(5,2,197),(3,3,238),(7,4,197),(7,6,238)], tiles=[37,-1,-1,-1,-1,-1,33,33,33,38,-1,27,27,27,5,5,166,166,166,36,-1,27,27,27,27,5,166,203,166,36,35,14,27,27,27,5,166,5,166,36,35,14,14,27,27,27,5,5,5,-1,35,14,14,14,14,27,27,5,5,-1,35,14,14,14,14,14,27,27,27,-1,39,34,34,34,34,34,-1,-1,-1,40]), # 103
    RoomTemplate(name='Flower Pond Exit (fixes for 94)', user='le_becc', logic=AND(FLIPPERS, OR(HOOKSHOT, MAGIC_ROD, BOOMERANG)), entities=[(3,3,126),(2,4,126),(5,4,126),(3,5,126),(5,5,160),(7,5,126),(2,6,126),(6,6,126)], tiles=[37,-1,-1,-1,-1,-1,-1,-1,-1,38,-1,13,13,13,5,13,13,223,13,-1,-1,13,5,19,19,19,19,19,13,-1,35,14,14,14,14,14,14,14,44,40,35,14,14,14,14,14,14,14,36,13,35,14,14,14,14,14,14,14,42,38,35,14,14,14,14,14,14,27,203,36,39,34,34,34,34,34,34,34,34,40]), # 104
    RoomTemplate(name='Zoo Exhibit', user='warlink05', entities=[(1,1,24),(8,1,159),(1,6,161),(8,6,143)], tiles=[37,33,33,33,-1,-1,33,33,33,38,35,13,13,16,5,5,17,13,13,36,35,19,19,20,5,5,21,19,19,36,-1,5,5,5,5,5,5,5,5,-1,-1,5,5,5,5,5,5,5,5,-1,35,18,18,22,5,5,23,18,18,36,35,13,13,16,5,5,17,13,13,36,39,34,34,34,-1,-1,34,34,34,40]), # 105
    RoomTemplate(name='Painful Heaven-Drive', user='warlink05', logic=POWER_BRACELET, entities=[(3,2,39),(6,2,39),(3,5,39),(6,5,39)], tiles=[37,33,33,33,-1,-1,33,33,33,38,35,223,32,5,5,5,5,32,13,36,35,13,16,13,15,13,13,17,13,-1,35,160,16,5,5,5,5,17,13,-1,35,13,16,5,5,5,5,17,13,-1,35,13,16,13,13,15,13,17,13,-1,35,13,32,5,5,5,5,32,13,36,39,34,34,34,-1,-1,34,34,34,40]), # 106
    RoomTemplate(name='Bomb Without Bombs', user='le_becc', logic=OR(SWORD, BOMB), entities=[(3,2,86),(7,2,86),(2,5,86),(7,5,86)], tiles=[37,33,199,33,33,33,33,199,33,38,-1,7,7,7,7,169,7,7,7,-1,-1,7,7,7,7,169,7,7,7,-1,-1,7,7,7,7,169,7,7,7,-1,-1,7,7,7,7,169,7,7,7,-1,-1,7,7,7,7,169,7,7,7,-1,-1,7,7,7,7,169,7,7,7,-1,39,34,200,34,34,34,34,200,34,40]), # 107
    RoomTemplate(name='A Familiar Room', user='Matty', entities=[(3,2,144),(6,3,144),(4,5,144)], tiles=[37,33,-1,-1,-1,-1,-1,-1,33,38,35,172,7,7,7,7,7,7,172,36,-1,7,7,7,7,7,7,7,7,-1,-1,7,7,7,7,7,7,7,7,-1,-1,7,7,7,7,7,7,7,7,-1,-1,7,7,7,7,7,7,7,7,-1,35,172,7,7,7,7,7,7,172,36,39,34,-1,-1,-1,-1,-1,-1,34,40]), # 109
    RoomTemplate(name='Bomb Push Horizontal', user='Matty', logic=BOMB, tiles=[37,33,-1,-1,33,33,33,33,33,38,35,172,7,7,7,17,7,7,172,36,-1,7,7,7,169,167,169,7,7,-1,-1,7,7,7,7,167,7,7,7,-1,-1,7,7,7,169,167,169,7,7,-1,-1,7,7,7,7,16,7,7,7,-1,39,34,34,34,34,34,34,34,34,40,13,13,223,13,223,13,13,223,13,13]), # 110
    RoomTemplate(name='Bomb Push Vertical', user='Matty', logic=BOMB, tiles=[37,33,-1,-1,33,33,-1,-1,33,38,35,172,7,7,16,17,7,7,172,36,35,7,7,7,7,17,7,7,7,36,35,19,167,167,169,167,7,169,7,36,35,7,169,7,167,169,167,167,18,36,35,7,7,7,16,7,7,7,7,36,35,172,7,7,16,17,7,7,172,36,39,34,-1,-1,34,34,-1,-1,34,40]), # 112
    RoomTemplate(name='Security Checkpoint Vertical', user='Matty', logic=POWER_BRACELET, entities=[(1,2,42),(8,5,42)], tiles=[37,-1,-1,-1,-1,-1,-1,-1,-1,38,201,5,5,13,5,13,5,13,5,202,35,5,5,166,166,166,166,166,166,36,35,5,5,5,32,32,13,5,13,36,35,5,13,5,32,32,15,5,5,36,35,166,166,166,166,166,166,5,5,36,201,5,5,5,5,13,5,13,5,202,39,-1,-1,-1,-1,-1,-1,-1,-1,40]), # 113
    RoomTemplate(name='Security Checkpoint Horizontal', user='Matty', logic=POWER_BRACELET, entities=[(7,1,42),(2,6,42)], tiles=[37,33,199,33,33,33,33,199,33,38,-1,5,166,13,5,13,5,13,5,-1,-1,5,166,5,32,32,5,5,5,-1,-1,5,166,5,32,167,166,166,13,-1,-1,5,166,166,167,32,15,166,5,-1,-1,5,5,5,32,32,5,166,5,-1,-1,5,5,5,5,13,5,166,5,-1,39,34,200,34,34,34,34,200,34,40]), # 114
    RoomTemplate(name='Maximum Security Vault', user='Matty', logic=POWER_BRACELET, entities=[(2,3,15),(7,3,15),(2,4,15),(7,4,15),(1,6,42),(8,6,42)], tiles=[37,33,199,-1,-1,-1,-1,199,33,38,35,32,7,7,7,7,7,7,32,36,201,7,7,44,34,34,43,7,7,202,-1,7,7,36,32,160,35,7,7,-1,-1,7,7,36,5,13,35,7,7,-1,201,7,7,172,152,152,172,7,7,202,35,7,7,7,7,7,7,7,7,36,39,34,200,34,34,34,34,200,34,40]), # 115
    RoomTemplate(name='Armos Maze at Home', user='Matty', logic=OR(HOOKSHOT, BOOMERANG, BOW), entities=[(4,1,15),(7,3,15),(1,4,15),(4,6,15)], tiles=[37,33,33,33,33,33,33,-1,-1,38,35,160,35,5,5,5,166,5,5,-1,35,5,35,5,166,13,166,13,5,-1,35,152,41,13,166,5,166,5,166,36,35,5,166,5,166,5,15,5,13,36,35,5,166,5,5,166,13,166,5,36,35,13,13,5,5,166,5,5,13,36,39,34,34,34,34,34,34,34,34,40]), # 116
    RoomTemplate(name='The Bird Shrine', user='Matty', entities=[(2,1,122),(7,1,122),(2,3,122),(7,3,122),(3,4,122),(6,4,122)], tiles=[37,33,33,33,33,33,33,33,33,38,-1,15,5,36,192,160,35,5,13,-1,-1,5,5,42,152,152,41,15,5,-1,-1,5,5,16,5,13,17,5,5,-1,-1,5,15,5,5,5,5,13,5,-1,-1,13,5,5,13,5,5,15,5,-1,-1,5,13,13,5,13,5,5,5,-1,39,-1,-1,-1,-1,-1,-1,-1,-1,40]), # 117
    RoomTemplate(name='Dead End', user='Matty', logic=BOMB, entities=[(6,3,80),(2,5,80)], tiles=[37,199,163,199,33,-1,-1,-1,33,38,35,7,7,7,171,13,5,13,32,36,35,7,7,7,171,5,5,5,5,-1,35,169,169,169,171,5,15,13,13,-1,35,13,5,5,171,5,5,13,5,-1,35,5,15,5,13,5,13,5,5,-1,35,32,13,5,13,5,5,5,32,36,39,34,34,34,34,-1,-1,-1,34,40]), # 118
    RoomTemplate(name='ALTTP Checkerboard Cave Remake', user='Darknesslink81', tiles=[37,33,33,33,33,33,33,33,33,38,35,172,16,5,167,5,167,5,160,36,35,172,16,167,5,166,5,167,5,36,35,172,16,5,167,5,167,5,167,36,35,172,16,167,5,166,5,166,5,36,35,172,16,5,167,5,167,5,166,36,35,172,16,5,5,37,33,33,33,36,39,34,40,-1,-1,39,34,34,34,40]), # 119
    RoomTemplate(name='ALTTP Cave45 Remake', user='Darknesslink81', logic=POWER_BRACELET, tiles=[37,33,33,33,-1,-1,-1,-1,33,38,35,160,5,32,5,5,13,5,15,36,35,5,5,32,5,32,5,32,5,36,35,13,13,32,5,5,5,5,5,36,39,34,34,43,32,5,44,34,34,40,35,23,22,35,5,5,36,23,22,36,35,21,20,35,5,5,36,21,20,36,39,34,34,41,-1,-1,42,34,34,40]), # 120
    RoomTemplate(name='The Legendary 100th Room', user='Matty', logic=HOOKSHOT, entities=[(7,2,87),(1,4,87),(5,5,161),(3,6,161)], tiles=[37,33,33,33,33,33,33,-1,-1,38,35,166,166,19,19,19,19,13,13,36,35,166,5,175,175,175,175,5,160,36,35,13,5,176,176,176,176,13,5,36,35,5,13,18,18,18,18,167,167,36,35,5,15,5,13,5,5,13,5,-1,35,13,5,13,5,5,13,5,5,-1,39,-1,-1,34,-1,-1,-1,-1,-1,40]), # 121
    RoomTemplate(name='Spider Pit', user='le_becc', logic=SWORD, entities=[(5,1,14),(3,2,178),(6,2,178),(5,3,178),(3,4,178),(3,5,178),(5,5,178),(2,6,14)], tiles=[37,-1,-1,-1,-1,-1,-1,-1,-1,38,35,13,13,13,5,5,13,5,13,36,39,34,43,175,175,175,175,44,152,40,43,221,35,1,1,1,44,40,221,44,41,221,35,1,1,1,36,221,221,42,37,152,41,176,176,176,42,33,33,38,35,13,13,5,5,13,13,5,13,36,39,-1,-1,-1,-1,-1,-1,-1,-1,40]), # 122
    RoomTemplate(name='Deepest Depths', user='Neonesque', entities=[(2,2,40),(6,3,156),(7,5,40)], tiles=[37,33,-1,-1,33,-1,-1,33,33,38,35,37,67,68,33,67,68,33,38,36,35,35,13,13,13,13,13,15,36,36,35,35,13,13,5,5,5,13,11,-1,-1,9,13,5,190,5,13,13,12,-1,-1,10,13,13,13,13,13,13,36,36,35,39,34,34,140,8,34,34,40,36,39,34,34,34,-1,-1,34,34,34,40]), # 124
    RoomTemplate(name='I-Beam Crossroads (Revision, Replace Previous)', user='Neonesque', logic=POWER_BRACELET, entities=[(4,2,41),(6,2,155),(7,5,204),(4,6,155)], tiles=[37,-1,-1,-1,33,33,-1,-1,-1,38,-1,5,13,5,5,5,13,13,13,-1,-1,5,15,13,5,5,13,13,5,-1,39,34,34,43,32,32,44,34,34,40,37,33,33,41,32,32,42,33,33,38,-1,5,5,13,13,27,27,27,27,-1,-1,13,13,5,27,27,27,27,5,-1,39,-1,-1,-1,34,34,-1,-1,-1,40]), # 126
    RoomTemplate(name='Raised Walkway', user='Neonesque', logic=PEGASUS_BOOTS, entities=[(3,2,87),(4,3,28),(7,3,28),(6,5,87)], tiles=[37,33,33,33,33,33,33,33,33,38,35,34,34,34,43,174,174,174,174,36,-1,5,13,5,39,34,34,34,34,36,-1,13,5,5,5,78,78,13,5,-1,35,33,152,152,33,33,33,38,5,-1,-1,5,5,13,16,32,5,42,33,36,-1,13,13,13,5,5,5,13,32,36,39,-1,-1,-1,-1,-1,-1,-1,34,40]), # 127
    RoomTemplate(name='Crumbling Floor', user='Neonesque', entities=[(5,3,176),(6,4,176),(2,5,178)], tiles=[37,-1,-1,-1,-1,33,-1,-1,-1,38,-1,13,13,13,13,174,5,13,13,-1,-1,5,32,174,223,13,223,175,5,-1,-1,5,223,13,13,174,5,176,174,36,35,174,5,174,174,5,175,223,5,-1,-1,13,174,223,5,223,176,32,13,-1,-1,13,13,5,13,13,5,13,5,-1,39,-1,-1,-1,-1,-1,-1,-1,-1,40]), # 128
    RoomTemplate(name='Block Pushing Maze', user='Neonesque', entities=[(3,3,27),(5,4,27),(7,5,27)], tiles=[37,33,33,199,33,33,199,33,33,38,35,13,13,166,5,166,166,13,5,-1,201,167,13,167,5,166,166,13,13,-1,-1,5,167,13,167,13,167,167,13,-1,-1,13,167,167,5,13,167,13,166,36,201,167,5,13,167,167,13,5,166,202,35,13,13,167,13,13,166,166,166,36,39,-1,-1,200,-1,-1,200,34,34,40]), # 129
    RoomTemplate(name='Winding Corridor', user='Neonesque', logic=OR(FEATHER,POWER_BRACELET), tiles=[37,33,33,33,33,38,37,-1,-1,38,35,5,223,13,5,36,35,13,5,-1,35,13,44,43,174,36,35,13,5,-1,35,223,36,35,223,42,41,223,5,-1,35,174,36,35,13,13,13,32,5,-1,-1,223,42,41,18,172,13,18,174,36,-1,13,13,223,5,32,5,13,13,36,39,-1,-1,-1,-1,34,-1,-1,-1,40]), # 130
    RoomTemplate(name='Wet Crossroads', user='Matty', entities=[(2,2,203),(7,2,203),(2,5,203),(7,5,203)], tiles=[37,33,33,33,-1,-1,33,33,33,38,35,14,14,14,27,27,14,14,14,36,35,14,14,27,27,27,27,14,14,36,-1,27,27,27,27,27,27,27,27,-1,-1,27,27,27,27,27,27,27,27,-1,35,14,14,27,27,27,27,14,14,36,35,14,14,14,27,27,14,14,14,36,39,34,34,34,-1,-1,34,34,34,40]), # 131
    RoomTemplate(name='This Bridge Sucks', user='Matty', entities=[(1,1,145),(4,1,145),(7,1,145),(2,6,145),(5,6,145),(8,6,145)], tiles=[37,33,33,33,33,33,33,33,33,38,35,13,15,5,13,5,13,5,13,36,35,34,34,34,34,34,34,34,152,36,9,16,17,13,5,16,17,5,5,11,10,5,5,16,17,5,13,16,17,12,35,152,33,33,33,33,33,33,33,36,35,5,5,13,13,5,15,13,5,36,39,34,34,34,34,34,34,34,34,40]), # 132
    RoomTemplate(name='Boot Lock Block Puzzle', user='Neonesque', logic=AND(BOMB,PEGASUS_BOOTS,FEATHER), entities=[(4,4,156)], tiles=[13,37,33,33,33,67,68,38,223,223,15,35,5,167,13,13,13,42,33,38,37,41,5,167,13,78,16,13,13,-1,35,78,167,13,18,18,18,167,5,-1,35,78,17,13,5,5,13,167,5,-1,35,13,21,19,19,19,19,20,5,-1,35,13,5,169,174,174,174,167,13,-1,39,34,34,34,34,34,34,34,34,40]), # 134
    RoomTemplate(name='Explosive Challenge', user='Matty', logic=BOMB, entities=[(2,2,33),(7,2,33),(2,5,33),(7,5,33)], tiles=[37,33,33,33,33,63,33,33,33,38,35,5,5,5,5,5,5,5,5,36,35,5,5,5,5,5,5,5,5,36,35,169,169,169,169,169,169,169,169,36,35,169,169,169,169,169,169,169,169,36,35,5,5,5,5,5,5,5,5,36,35,5,5,5,5,5,5,5,5,36,39,-1,-1,-1,-1,-1,-1,-1,-1,40]), # 135
    RoomTemplate(name='Two Options', user='Matty', logic=OR(HOOKSHOT, FEATHER), tiles=[37,33,199,33,-1,-1,33,199,33,38,-1,5,5,166,5,5,166,5,5,-1,-1,5,5,166,5,5,166,5,5,-1,166,5,5,175,175,175,175,5,5,166,166,5,5,176,176,176,176,5,5,166,-1,5,5,166,5,5,166,5,5,-1,-1,5,5,166,5,5,166,5,5,-1,39,34,200,34,-1,-1,34,200,34,40]), # 136
    RoomTemplate(name='Subtle Hint', user='Neonesque', entities=[(8,1,122),(3,3,156),(7,4,156)], tiles=[37,-1,-1,-1,38,13,15,223,13,223,-1,5,5,5,36,37,33,33,33,38,-1,5,32,5,42,41,13,5,5,36,-1,5,5,5,5,5,5,13,5,36,-1,5,5,13,13,13,13,13,13,74,-1,5,5,5,5,5,5,13,5,36,-1,5,5,44,43,5,13,5,44,40,39,-1,-1,40,39,34,34,34,40,13]), # 138
    RoomTemplate(name='Attractive Pillar', user='Neonesque', logic=FEATHER, entities=[(4,3,82),(7,3,155),(6,4,176),(2,5,176)], tiles=[37,33,33,-1,-1,-1,33,33,33,38,-1,13,175,13,13,5,175,5,13,-1,-1,13,1,44,34,43,1,13,5,-1,-1,5,1,36,5,35,1,5,5,-1,35,13,1,42,33,41,1,5,13,-1,35,5,176,174,174,174,176,13,5,-1,35,13,13,5,5,13,13,13,5,-1,39,34,34,34,-1,-1,-1,-1,-1,40]), # 139
    RoomTemplate(name='Crystal Staircase', user='Neonesque', entities=[(3,3,14),(6,4,14)], tiles=[37,-1,-1,-1,-1,-1,-1,-1,-1,38,35,5,5,5,13,13,5,13,5,36,35,33,152,33,33,33,33,33,33,36,35,221,5,5,13,221,221,5,5,36,35,13,13,221,5,5,5,13,221,36,35,33,33,33,33,33,33,152,33,36,35,5,13,5,13,13,13,5,5,36,39,-1,-1,-1,-1,-1,-1,-1,-1,40]), # 140
    RoomTemplate(name='Fast Ganon?', user='warlink05', tiles=[37,33,33,-1,-1,-1,-1,33,33,38,35,223,223,223,223,223,223,223,223,36,-1,223,5,15,5,5,13,5,223,-1,-1,223,5,13,5,5,5,5,223,-1,-1,223,13,5,13,203,5,13,223,-1,-1,223,171,5,5,13,5,172,223,-1,35,223,223,223,223,223,223,223,223,36,39,34,34,-1,-1,-1,-1,34,34,40]), # 141
    RoomTemplate(name='Grand Hall', user='Neonesque', entities=[(5,2,145),(4,4,174),(8,5,174),(1,6,145)], tiles=[37,-1,-1,-1,-1,-1,-1,-1,-1,38,-1,13,5,5,5,5,13,13,5,-1,-1,5,172,13,13,13,13,172,5,-1,-1,13,13,13,5,5,13,5,13,-1,35,5,172,5,5,5,13,172,5,36,35,5,13,5,5,13,13,13,13,36,35,5,172,13,5,13,5,172,5,36,39,43,13,5,5,13,5,5,44,40]), # 142
    RoomTemplate(name='Ring Arena', user='Neonesque', logic=FEATHER, entities=[(4,4,81),(5,7,28)], tiles=[37,33,33,199,19,19,199,33,33,38,-1,13,175,174,174,174,174,175,13,-1,-1,13,1,18,18,18,18,1,5,-1,-1,5,1,13,5,13,5,1,13,-1,-1,5,1,5,5,13,5,1,13,-1,-1,13,1,19,19,19,19,1,13,-1,-1,5,176,174,174,174,174,176,13,-1,39,34,34,200,18,18,200,34,34,40]), # 143
    RoomTemplate(name='Pokey Habitat', user='Neonesque', logic=BOMB, entities=[(5,1,197),(7,3,227),(1,4,197),(4,5,227),(8,6,197)], tiles=[37,-1,-1,-1,33,33,33,33,33,38,-1,5,5,13,16,5,5,13,13,-1,-1,5,13,13,16,5,13,15,13,-1,35,19,169,19,20,5,13,13,5,-1,35,13,13,13,5,13,13,13,5,-1,35,15,13,5,5,13,13,5,5,-1,35,13,13,5,5,13,13,5,13,36,39,-1,-1,-1,-1,34,34,34,34,40]), # 144
    RoomTemplate(name='Bunny Hop', user='Neonesque', logic=AND(HOOKSHOT,OR(BOW,BOMB,MAGIC_ROD,AND(OCARINA,SONG1))), entities=[(1,1,28),(7,2,28),(4,3,24),(5,3,24),(8,4,28),(2,5,28)], tiles=[37,33,33,33,33,33,33,33,38,166,9,13,5,35,174,174,36,13,36,13,10,13,13,35,19,19,36,5,42,38,35,166,5,35,13,13,36,13,166,36,39,43,13,35,18,18,36,13,5,36,13,35,13,35,175,175,36,13,13,36,166,35,5,35,176,176,36,5,5,36,223,39,34,34,34,34,34,140,8,40]), # 145
    RoomTemplate(name='Snakey Path', user='Neonesque', entities=[(3,2,41),(6,4,41),(8,6,82)], tiles=[37,33,33,33,33,33,33,33,33,38,35,44,34,34,34,34,43,174,174,36,35,36,13,5,13,13,35,44,34,36,35,36,5,37,38,5,39,40,13,11,35,36,5,35,36,13,5,13,5,12,35,40,13,35,42,33,33,44,34,40,35,13,13,35,174,174,174,36,13,223,39,140,8,34,34,34,34,40,13,15]), # 147
    RoomTemplate(name='Cliff Face', user='Neonesque', entities=[(4,4,11),(6,5,13),(2,6,13)], tiles=[42,33,41,33,33,33,33,42,33,41,42,33,41,19,19,19,19,42,33,41,42,33,33,33,33,33,33,33,33,41,33,33,33,33,33,33,33,33,33,33,5,13,13,15,13,13,13,13,5,13,5,5,5,13,13,13,5,5,5,5,13,13,5,5,5,5,5,5,13,44,34,34,34,43,5,5,13,13,13,36]), # 148
    RoomTemplate(name='Beachy Junction', user='Neonesque', entities=[(6,2,198),(3,3,198),(4,4,198),(2,5,160)], tiles=[37,-1,-1,-1,-1,-1,-1,-1,38,13,-1,5,13,13,5,13,5,5,36,5,-1,13,5,5,27,27,27,27,36,17,-1,5,27,27,27,27,13,13,36,223,-1,27,27,27,27,5,13,44,40,13,35,27,27,27,5,13,5,36,13,13,35,27,27,13,5,5,5,36,15,223,39,34,-1,-1,-1,-1,-1,40,223,5]), # 149
    RoomTemplate(name='Down We Go!', user='Matty', logic=POWER_BRACELET, tiles=[37,-1,-1,-1,-1,-1,-1,-1,-1,38,35,13,5,5,5,5,13,13,5,36,39,43,5,13,166,166,166,166,166,36,13,35,5,167,5,5,5,13,44,40,223,35,5,167,32,32,32,5,42,38,37,41,5,5,166,190,166,5,13,36,35,172,13,5,166,166,166,13,172,36,39,34,34,34,34,34,34,34,34,40]), # 151
    RoomTemplate(name='Precise Swimming', user='le_becc', logic=FLIPPERS, entities=[(1,3,126),(1,4,126),(5,4,126),(3,5,126),(7,5,126),(4,6,126),(5,6,126),(6,6,126)], tiles=[13,37,-1,-1,-1,38,13,37,33,38,37,41,27,27,27,36,223,35,27,-1,35,14,14,44,34,40,37,41,27,-1,35,14,14,42,33,33,41,14,27,-1,35,14,14,14,14,14,14,14,14,-1,35,14,14,14,14,14,14,14,44,40,39,43,14,14,14,14,14,44,40,13,13,39,34,34,34,34,34,40,13,223]), # 152
    RoomTemplate(name='Pit Lock Block Puzzle', user='Neonesque', logic=BOMB, entities=[(7,1,25),(3,2,28),(4,3,28),(4,5,25)], tiles=[37,-1,-1,-1,-1,38,13,13,223,13,-1,13,5,13,13,42,33,33,33,38,-1,13,5,5,5,13,16,13,172,36,35,169,223,223,15,5,167,13,5,36,201,5,167,223,44,43,223,167,167,202,35,18,13,18,42,41,223,17,13,36,35,13,13,5,223,223,223,17,5,36,39,34,200,34,34,200,34,140,8,40]), # 153
    RoomTemplate(name='Shy Bottleneck', user='Neonesque', entities=[(5,1,143),(2,3,143),(4,3,21),(6,4,143)], tiles=[37,-1,-1,-1,-1,33,33,38,223,223,-1,13,13,13,13,13,13,36,223,223,-1,13,32,13,13,13,13,36,223,223,35,13,13,13,13,13,13,42,33,38,-1,13,13,44,34,43,13,13,13,-1,-1,13,13,36,223,35,13,32,13,-1,-1,13,13,36,223,39,43,13,13,-1,39,-1,-1,40,223,223,39,-1,-1,40]), # 156
    RoomTemplate(name='Four Corners', user='Neonesque', logic=FEATHER, entities=[(2,1,144),(8,2,144),(3,5,144),(6,6,32)], tiles=[37,33,33,33,33,-1,-1,-1,33,38,-1,5,5,223,174,5,223,5,174,36,-1,223,5,44,43,174,5,5,5,36,-1,5,175,36,39,34,34,43,174,36,35,174,176,42,33,33,33,41,5,-1,35,5,223,5,5,175,5,223,5,-1,35,5,5,223,5,176,5,174,5,-1,39,-1,-1,-1,-1,34,34,34,34,40]), # 157
    RoomTemplate(name='Flooded Four Corners', user='Neonesque', logic=FEATHER, entities=[(6,1,44),(4,3,39),(5,5,44),(2,6,160)], tiles=[37,-1,-1,-1,33,33,33,33,33,38,35,27,27,27,14,27,27,14,27,-1,35,27,14,27,14,14,27,27,27,-1,35,27,27,27,27,14,14,27,27,-1,35,14,14,14,14,14,14,14,14,36,-1,27,27,27,14,27,27,14,27,36,-1,27,27,27,14,14,27,27,27,36,39,34,34,34,34,34,-1,-1,-1,40]), # 158
    RoomTemplate(name='Walled Pathway', user='Neonesque', entities=[(8,1,39),(5,4,40),(6,4,40),(4,6,40),(5,6,40)], tiles=[37,33,33,-1,-1,-1,-1,-1,33,38,-1,5,32,17,13,13,13,16,13,36,-1,5,32,17,13,32,32,16,13,36,-1,5,32,17,13,18,18,18,13,36,-1,5,32,17,13,13,13,13,13,36,-1,5,5,18,18,18,18,18,13,36,35,5,5,5,5,5,5,5,5,36,39,34,34,34,34,34,34,34,34,40]), # 159
    RoomTemplate(name='Cracks', user='pauto', entities=[(1,1,18),(2,5,11),(7,5,20)], tiles=[37,33,33,33,33,33,33,33,33,38,35,171,5,17,160,16,5,5,171,36,35,5,5,21,223,20,5,5,5,36,35,5,13,223,223,223,174,5,5,36,35,5,5,223,223,223,13,5,5,66,35,32,5,5,5,5,5,13,32,36,35,171,5,5,5,5,5,5,171,36,39,34,34,43,5,44,34,34,34,40]), # 160
    RoomTemplate(name='Radical Jump', user='Neonesque', logic=AND(FEATHER,PEGASUS_BOOTS), tiles=[13,13,37,33,33,33,33,33,33,38,13,13,35,13,13,166,166,13,13,36,37,33,41,174,174,166,166,174,174,36,9,22,35,78,78,174,174,78,78,36,10,13,35,174,174,166,166,174,174,36,35,152,41,13,13,166,166,13,13,-1,35,13,13,13,13,166,166,13,13,-1,39,34,34,34,34,34,34,-1,-1,40]), # 161
    RoomTemplate(name='Partitioned Ledge', user='Neonesque', logic=AND(PEGASUS_BOOTS,FEATHER), entities=[(7,1,27)], tiles=[37,33,33,33,33,33,33,33,33,38,35,13,13,175,175,175,13,13,13,36,35,175,175,1,176,1,175,174,174,36,35,1,1,1,78,1,1,13,13,36,35,176,176,176,78,176,176,174,174,36,9,18,78,22,78,18,18,18,18,-1,10,5,5,16,5,5,5,5,5,-1,39,34,34,34,-1,-1,-1,-1,-1,40]), # 162
    RoomTemplate(name='Corner Pocket', user='Neonesque', entities=[(3,3,33),(8,3,33),(3,6,33)], tiles=[37,-1,-1,-1,-1,-1,-1,-1,-1,38,-1,5,5,5,5,5,5,5,5,36,-1,5,32,32,5,5,5,32,32,36,-1,5,32,13,5,5,5,32,13,36,-1,5,5,5,5,37,33,33,33,42,-1,5,32,32,37,41,175,175,175,175,-1,5,32,13,35,175,1,1,1,1,39,34,34,34,43,1,1,1,1,1]), # 163
    RoomTemplate(name='Off Limits', user='Neonesque', entities=[(6,0,159),(3,2,156),(6,3,156),(4,5,156),(2,7,159)], tiles=[35,5,223,5,223,5,5,5,223,36,35,19,19,19,19,19,19,19,19,36,-1,223,5,5,5,5,223,5,5,-1,-1,5,5,174,174,5,5,223,5,-1,-1,5,223,223,5,174,174,5,5,-1,-1,5,5,5,5,223,5,5,223,-1,35,18,18,18,18,18,18,18,18,36,35,223,5,5,223,5,223,223,5,36]), # 165
    RoomTemplate(name='Push-Block T-Junction', user='Neonesque', entities=[(8,2,124),(5,4,159),(0,6,124)], tiles=[13,13,13,37,-1,-1,38,13,13,13,13,13,37,41,5,5,42,38,13,13,37,33,41,5,167,167,166,36,13,13,-1,5,5,167,5,5,166,36,13,13,-1,5,5,167,5,5,166,36,13,13,39,34,43,5,167,167,166,36,13,13,13,13,39,43,5,5,44,40,13,13,13,13,13,39,-1,-1,40,13,13,13]), # 166
    RoomTemplate(name='Crossroads of Power', user='Neonesque', logic=POWER_BRACELET, entities=[(4,3,24),(5,4,24)], tiles=[223,223,223,37,-1,-1,38,223,223,223,223,223,37,41,5,5,42,38,223,223,37,33,41,32,32,32,32,42,33,38,-1,5,5,32,5,5,32,5,5,-1,-1,5,5,32,5,5,32,5,5,-1,39,34,43,32,32,32,32,44,34,40,223,223,39,43,5,5,44,40,223,223,223,223,223,39,-1,-1,40,223,223,223]), # 167
    RoomTemplate(name='Trial of Power', user='Neonesque', logic=POWER_BRACELET, entities=[(6,1,28),(2,4,32),(5,6,21)], tiles=[37,-1,-1,-1,-1,38,18,18,18,22,-1,13,13,13,13,36,5,5,160,16,-1,13,13,13,13,42,38,5,5,16,-1,13,13,175,32,175,42,152,33,38,-1,13,13,1,5,1,32,32,32,36,-1,13,13,1,5,176,174,174,5,36,35,174,174,176,5,5,5,5,5,36,39,34,34,34,34,34,34,34,34,40]), # 168
    RoomTemplate(name='Wizzrobe Crossing', user='Neonesque', entities=[(4,2,33),(3,3,33),(6,4,33),(5,5,33)], tiles=[37,33,33,-1,-1,-1,-1,-1,-1,38,35,32,16,5,5,5,5,5,5,-1,-1,5,16,5,5,5,5,17,5,-1,-1,5,16,5,5,5,5,17,5,-1,-1,5,16,5,5,5,5,17,5,-1,-1,5,16,5,5,5,5,17,5,-1,-1,5,5,5,5,5,5,17,32,36,39,-1,-1,-1,-1,-1,-1,34,34,40]), # 169
    RoomTemplate(name='Rollover Highway', user='Neonesque', entities=[(6,1,83),(4,2,27),(7,3,28),(2,4,28),(5,4,27)], tiles=[37,33,-1,-1,-1,33,33,33,38,15,35,175,17,5,5,175,5,175,42,38,201,1,17,5,13,176,174,176,1,202,35,1,5,5,5,5,5,5,1,36,35,1,5,5,5,13,5,5,1,36,201,1,174,174,174,17,5,16,1,202,35,176,17,5,5,5,5,16,176,36,39,34,-1,-1,-1,-1,-1,-1,34,40]), # 170
    RoomTemplate(name='Precarious Cavern', user='Neonesque', logic=OR(FEATHER,HOOKSHOT), entities=[(1,1,25),(5,2,25),(3,3,32),(6,6,25)], tiles=[15,37,33,33,33,33,33,67,68,38,33,41,166,166,175,32,166,5,5,36,175,175,5,5,1,5,166,5,32,36,1,1,32,5,1,5,166,5,5,36,176,176,5,5,1,174,174,174,174,36,43,13,174,174,1,13,13,13,13,36,35,13,13,13,176,166,166,166,166,36,39,43,13,44,34,34,34,34,34,40]), # 171
    RoomTemplate(name='Tossing Peanuts', user='Neonesque', logic=BOMB, entities=[(2,2,85),(7,2,96),(4,3,85),(3,5,85),(8,5,96)], tiles=[37,199,-1,-1,199,33,33,33,33,33,-1,5,5,5,5,16,35,15,174,175,-1,5,5,5,5,16,35,15,15,1,35,5,5,5,5,16,35,15,15,1,35,5,5,5,5,16,35,174,15,1,-1,5,5,5,5,16,35,15,15,176,-1,5,5,5,5,16,35,15,15,44,39,200,-1,-1,200,34,34,34,34,40]), # 172
    RoomTemplate(name='Haven\'t I been here allready?', user='TheRubyGemstone', entities=[(4,2,143)], tiles=[37,33,33,33,33,33,33,33,33,38,35,15,15,15,15,15,5,160,166,36,35,15,7,15,7,15,5,5,166,36,35,15,7,15,7,15,5,5,5,36,35,15,15,15,15,15,5,5,192,36,35,5,5,5,5,5,5,166,166,36,35,32,32,5,5,5,5,5,192,36,39,34,34,34,-1,-1,34,34,34,40]), # 173
    RoomTemplate(name='Fishing Puddle', user='dragonc0', entities=[(2,3,204),(7,4,204)], tiles=[37,-1,-1,-1,-1,-1,-1,-1,-1,38,-1,5,5,5,27,27,5,5,5,-1,-1,5,13,13,5,27,27,13,5,-1,-1,5,27,27,14,14,27,27,5,-1,-1,5,27,27,14,14,27,27,5,-1,-1,5,5,13,13,27,27,5,5,-1,-1,5,5,5,27,27,5,5,5,-1,39,-1,-1,-1,-1,-1,-1,-1,-1,40]), # 174
    RoomTemplate(name='Chess formation', user='dragonc0', logic=POWER_BRACELET, entities=[(1,6,39),(2,6,24),(3,6,21),(4,6,15),(5,6,160),(6,6,21),(7,6,24),(8,6,39)], tiles=[37,-1,-1,-1,-1,-1,-1,-1,-1,38,-1,7,7,7,7,7,7,7,7,-1,-1,7,32,32,32,32,32,32,7,-1,-1,7,7,7,7,7,7,7,7,-1,-1,7,7,7,7,7,7,7,7,-1,35,7,7,7,7,7,7,7,7,36,35,7,7,7,7,7,7,7,7,36,39,34,34,34,34,34,34,34,34,40]), # 175
    RoomTemplate(name='Hookshot Puzzle?', user='dragonc0', logic=OR(HOOKSHOT, AND(PEGASUS_BOOTS, FEATHER)), tiles=[37,-1,-1,-1,-1,-1,-1,-1,-1,38,-1,13,19,19,19,19,19,19,5,-1,-1,13,1,1,5,167,1,1,160,36,-1,13,1,5,167,5,1,1,5,166,-1,16,1,1,1,1,1,1,166,166,-1,16,1,1,167,5,1,1,5,166,-1,16,1,5,1,1,1,1,5,166,39,34,34,166,34,34,34,34,34,40]), # 176
    RoomTemplate(name='In another castle', user='le_becc', tiles=[37,33,38,42,163,33,41,37,33,38,35,172,36,192,13,13,192,35,172,36,-1,5,36,13,13,13,13,35,5,-1,-1,5,36,192,13,13,192,35,5,-1,-1,5,42,33,152,152,33,41,5,-1,-1,5,5,5,13,13,5,5,5,-1,35,172,5,5,13,13,5,5,172,36,39,34,34,200,-1,-1,200,34,34,40]), # 178
    RoomTemplate(name='Agile Cueball Arena', user='Neonesque', logic=OR(FLIPPERS,FEATHER,HOOKSHOT), entities=[(1,1,142)], tiles=[37,33,166,166,-1,-1,166,166,33,38,35,27,27,27,27,27,27,27,27,-1,35,14,14,14,14,14,14,14,27,-1,35,14,14,14,27,27,14,14,27,-1,-1,27,14,14,27,27,14,14,14,36,-1,27,14,14,14,14,14,14,14,36,-1,27,27,27,27,27,27,27,27,36,39,34,166,166,-1,-1,166,166,34,40]), # 179
    RoomTemplate(name='Cluttered Smasher Arena', user='Neonesque', logic=POWER_BRACELET, entities=[(4,4,146)], tiles=[37,33,-1,-1,-1,-1,-1,-1,33,38,-1,5,17,5,5,5,5,16,5,-1,-1,5,16,32,32,32,32,17,5,-1,-1,5,32,5,5,5,5,32,5,-1,-1,5,32,5,5,5,5,32,5,-1,-1,5,16,32,32,32,32,17,5,-1,-1,5,17,5,5,5,5,16,5,-1,39,34,-1,-1,-1,-1,-1,-1,34,40]), # 180
    RoomTemplate(name='Furious Tag Team', user='Neonesque', entities=[(3,2,137),(5,3,136)], tiles=[15,37,33,33,33,33,33,33,38,15,37,41,174,174,223,223,174,174,42,38,-1,5,5,5,5,5,5,5,5,-1,-1,5,223,5,5,5,223,5,5,-1,-1,5,5,5,5,223,5,5,5,-1,-1,5,5,223,5,5,5,223,5,-1,-1,5,5,5,5,5,5,5,5,-1,39,-1,-1,-1,-1,-1,-1,-1,-1,40]), # 181
    RoomTemplate(name='Downhill Avalaunch Arena', user='Neonesque', entities=[(4,1,244)], tiles=[37,-1,-1,-1,33,33,-1,-1,-1,38,-1,5,5,5,5,5,5,5,5,-1,-1,5,5,5,5,5,5,5,5,-1,-1,5,5,5,5,5,5,5,5,-1,-1,5,5,37,33,33,38,5,5,-1,35,37,152,41,13,13,42,152,38,36,35,35,13,13,13,13,13,13,36,36,35,39,-1,-1,-1,-1,-1,-1,40,36]), # 184
    RoomTemplate(name='Sinkhole Entrance', user='Neonesque', entities=[(3,1,14),(1,3,14),(8,4,14),(5,6,14)], tiles=[37,-1,-1,33,-1,-1,-1,-1,-1,38,-1,5,5,5,5,5,5,5,5,-1,-1,5,37,33,33,152,33,38,5,-1,35,5,35,13,190,13,13,36,5,-1,-1,5,35,13,13,13,13,36,5,36,-1,5,39,34,34,34,34,40,5,-1,-1,5,5,5,5,5,5,5,5,-1,39,-1,-1,-1,-1,34,-1,-1,-1,40]), # 186
    RoomTemplate(name='Snake Valley', user='Neonesque', logic=HOOKSHOT, entities=[(8,1,161),(1,3,227),(5,4,161),(3,6,161)], tiles=[37,33,33,33,33,166,41,13,42,38,35,5,223,5,36,13,13,13,13,36,35,5,37,152,36,13,37,33,33,36,35,5,35,5,42,33,41,174,5,-1,35,5,35,5,223,5,5,5,5,-1,35,223,39,34,34,34,43,223,5,-1,35,5,5,223,5,5,35,5,5,-1,39,34,34,34,34,34,34,-1,-1,40]), # 187
    RoomTemplate(name='This would be faster with Switch Hook', user='TheRubyGemstone', logic=SWORD, tiles=[37,33,33,33,33,33,38,5,5,5,35,221,221,5,13,190,36,5,5,5,35,221,15,44,34,34,40,5,5,5,-1,13,5,36,5,5,5,5,5,5,-1,5,13,36,5,5,5,5,5,5,35,221,5,42,33,33,33,38,5,5,35,221,221,5,5,5,15,36,5,5,39,34,34,-1,-1,-1,-1,40,5,5]), # 189
    RoomTemplate(name='At the Precipice', user='Neonesque', tiles=[33,33,33,41,13,13,42,33,33,33,33,33,41,19,19,19,19,42,33,33,33,33,33,33,33,33,33,33,33,33,41,19,19,19,42,33,33,33,33,33,33,33,33,33,33,41,175,174,174,175,175,175,175,175,175,175,1,44,43,1,1,1,1,1,1,1,1,42,41,1,1,1,1,1,1,1,1,175,175,1]), # 195
    RoomTemplate(name='Hi, nox! And lasers', user='Kabarakh', logic=OR(SWORD, BOMB, BOW, MAGIC_ROD, BOOMERANG, HOOKSHOT), entities=[(1,1,42),(5,1,244),(8,6,42)], tiles=[37,33,33,-1,-1,-1,-1,33,33,38,35,13,16,13,13,13,19,19,19,36,35,13,16,13,19,25,13,13,13,36,35,166,166,13,13,13,166,166,152,36,35,13,13,166,166,166,13,13,13,36,35,152,19,19,19,19,19,23,18,36,35,13,13,13,13,13,13,17,13,36,39,34,34,-1,-1,-1,-1,34,34,40]), # 198
    RoomTemplate(name='Itemcheck Crossroads', user='Kabarakh', logic=OR(AND(PEGASUS_BOOTS, POWER_BRACELET, FEATHER), AND(BOMB, POWER_BRACELET, FEATHER), AND(BOMB, PEGASUS_BOOTS, FEATHER), AND(BOMB, PEGASUS_BOOTS, POWER_BRACELET)), tiles=[37,33,33,33,-1,-1,33,33,33,38,35,172,192,192,5,5,192,192,172,36,35,192,192,169,13,5,78,192,192,36,-1,5,5,5,166,166,5,13,5,-1,-1,5,5,15,166,166,5,15,5,-1,35,192,192,175,13,5,32,192,192,36,35,172,192,192,5,15,192,192,172,36,39,34,34,34,-1,-1,34,34,34,40]), # 199
    RoomTemplate(name='Obligatory 1-1 Remake', user='TheRubyGemstone', entities=[(7,6,159)], tiles=[37,33,33,33,33,33,33,33,33,38,-1,27,27,27,27,27,166,27,27,-1,-1,27,27,27,27,27,27,27,27,-1,-1,27,27,27,27,27,27,27,27,-1,35,166,27,27,63,160,63,166,63,36,-1,27,27,27,27,27,27,27,27,-1,-1,27,27,27,27,27,27,27,27,-1,39,34,34,34,34,34,34,34,34,40]), # 205
    RoomTemplate(name='Doorway Up', user='dragonc0', tiles=[37,33,33,33,67,68,33,33,33,38,-1,5,5,172,7,7,172,5,5,-1,-1,5,5,7,7,7,7,5,5,-1,-1,5,5,7,7,7,7,5,5,-1,-1,5,5,5,5,5,5,5,5,-1,-1,5,5,5,5,5,5,5,5,-1,-1,5,5,5,5,5,5,5,5,-1,39,-1,-1,-1,-1,-1,-1,-1,-1,40]), # 206
    RoomTemplate(name='Desert Crossroads', user='dragonc0', entities=[(4,3,14),(7,4,227),(2,5,14)], tiles=[37,-1,-1,-1,-1,-1,-1,-1,-1,38,-1,5,13,13,5,5,13,13,5,-1,-1,13,5,5,13,13,5,5,13,-1,-1,5,13,15,5,5,13,13,5,-1,-1,13,5,5,13,13,5,5,13,-1,-1,5,13,13,5,15,13,13,5,-1,-1,13,5,5,13,13,5,5,13,-1,39,-1,-1,-1,-1,-1,-1,-1,-1,40]), # 207
    RoomTemplate(name='not really one ways', user='Kabarakh', entities=[(7,1,32),(2,3,25),(7,3,25),(7,5,27),(2,6,27)], tiles=[37,33,-1,-1,-1,-1,-1,-1,33,38,-1,5,5,5,5,5,5,5,13,-1,-1,5,15,32,32,32,32,13,5,-1,35,174,174,172,174,174,172,174,174,36,35,167,167,172,13,5,172,167,167,36,-1,5,5,5,5,13,5,5,5,-1,-1,5,13,5,5,5,15,5,5,-1,39,34,-1,-1,-1,-1,-1,-1,34,40]), # 208
    RoomTemplate(name='Stupid racoon left something behind', user='Kabarakh', tiles=[41,42,41,5,5,5,13,36,35,223,42,41,5,5,5,5,13,42,44,43,43,5,5,221,221,5,5,15,42,41,41,5,221,166,166,221,15,160,44,43,43,5,221,166,166,221,5,13,42,41,41,5,5,221,221,5,13,13,44,43,43,5,5,15,5,5,13,44,43,41,41,44,43,5,5,13,13,36,35,223]), # 210
    RoomTemplate(name='Next Floor', user='dragonc0', tiles=[37,-1,-1,-1,-1,-1,-1,-1,-1,38,-1,5,5,5,5,5,5,5,5,-1,-1,5,23,44,34,34,43,22,5,-1,-1,5,17,42,199,163,41,16,5,-1,-1,5,17,21,19,5,20,16,5,-1,-1,5,21,19,20,5,21,20,5,-1,-1,5,5,5,5,5,5,5,5,-1,39,-1,-1,-1,-1,-1,-1,-1,-1,40]), # 211
    RoomTemplate(name='Give him his ball back!', user='le_becc', logic=POWER_BRACELET, entities=[(3,4,146)], tiles=[37,-1,-1,-1,-1,33,-1,-1,-1,38,-1,13,13,13,13,32,5,5,5,-1,-1,13,13,13,13,32,5,5,5,-1,-1,13,13,13,13,32,5,5,5,-1,-1,13,13,13,13,32,5,5,5,-1,-1,13,13,13,13,32,5,5,5,-1,-1,13,13,13,13,32,5,5,5,-1,39,-1,-1,-1,-1,34,-1,-1,-1,40]), # 212
    RoomTemplate(name='Enter the Egg, Hoot! The Wind Fish is waiting.', user='TheRubyGemstone', tiles=[1,1,1,44,34,34,34,43,1,1,1,1,1,36,166,32,166,35,1,1,27,27,44,36,166,163,166,35,43,27,27,27,36,42,33,152,33,41,35,27,14,44,36,42,33,152,33,41,35,43,14,36,42,33,33,152,33,33,41,35,14,42,33,33,33,152,33,33,33,41,34,34,34,34,34,-1,34,34,34,34]), # 213
    RoomTemplate(name='Sentries', user='Neonesque', entities=[(7,2,15),(5,4,15),(2,6,15)], tiles=[37,33,33,-1,-1,33,33,33,33,38,-1,5,35,5,5,36,5,167,5,-1,-1,5,35,5,5,36,5,15,5,-1,-1,5,35,167,5,42,152,38,5,-1,-1,5,35,5,5,15,5,36,5,-1,-1,5,39,34,34,34,34,40,5,-1,-1,5,15,5,5,5,5,5,5,-1,39,34,34,-1,-1,-1,-1,-1,-1,40]), # 215
    RoomTemplate(name='Sharp Buzz Blob Arena', user='Neonesque', logic=PEGASUS_BOOTS, entities=[(4,4,248)], tiles=[37,-1,-1,-1,33,33,33,33,33,38,35,5,5,5,78,5,5,5,5,-1,35,5,171,78,78,78,78,78,5,-1,35,78,78,78,5,5,5,78,5,-1,-1,5,78,5,5,5,78,78,78,36,-1,5,78,78,78,78,78,171,5,36,-1,5,5,5,5,78,5,5,5,36,39,34,34,34,34,34,-1,-1,-1,40]), # 216
    RoomTemplate(name='Jagged Snake Bridge', user='Neonesque', entities=[(3,1,161),(6,3,161),(5,6,161)], tiles=[37,33,33,33,41,176,1,176,42,38,-1,5,5,5,5,5,1,5,5,-1,-1,5,174,175,5,174,176,175,5,-1,-1,5,5,1,5,5,5,1,5,-1,-1,5,5,1,174,5,175,1,5,-1,-1,5,174,1,5,5,176,176,5,-1,-1,5,5,1,175,5,5,5,5,-1,39,34,43,1,1,44,34,34,34,40]), # 217
    RoomTemplate(name='Zora\'s Domain', user='le_becc', entities=[(4,1,124),(3,2,203),(7,2,203)], tiles=[37,33,33,33,33,33,33,33,33,38,-1,16,160,14,14,14,14,14,17,-1,-1,16,27,14,14,14,14,14,17,-1,-1,16,14,14,14,14,14,14,17,-1,-1,16,14,14,14,14,14,14,17,-1,-1,13,192,18,152,152,18,192,13,-1,-1,5,5,5,5,5,5,5,5,-1,39,-1,-1,-1,-1,-1,-1,-1,-1,40]), # 219
    RoomTemplate(name='Eastern Ledge', user='Neonesque', logic=OR(BOMB,BOW,BOOMERANG,MAGIC_ROD), event=0x81, entities=[(8,0,28),(5,1,28),(7,1,41),(7,3,28),(9,5,28),(6,6,28),(9,6,41)], tiles=[37,33,199,41,35,5,5,5,5,5,-1,5,5,16,35,5,5,5,5,44,-1,5,5,16,39,43,5,5,5,42,-1,5,15,16,19,35,5,5,5,5,-1,5,5,5,16,35,5,5,5,5,-1,5,5,5,16,35,5,5,5,5,-1,5,5,5,16,35,5,5,5,5,39,34,200,34,34,34,43,5,5,5]), # 220
    RoomTemplate(name='Spiny Bounty', user='Neonesque', logic=SHIELD, event=0x61, entities=[(4,1,44),(3,3,44),(5,4,44),(7,6,44)], tiles=[37,-1,-1,-1,33,-1,-1,-1,-1,38,-1,5,5,5,5,5,5,13,13,36,-1,5,175,174,174,174,174,13,5,202,-1,5,1,5,5,5,5,13,13,36,-1,5,1,5,5,5,5,5,5,-1,-1,5,176,174,174,174,174,5,5,-1,-1,5,5,5,5,5,5,5,5,-1,39,-1,-1,-1,-1,-1,34,34,34,40]), # 221
    RoomTemplate(name='Blaino Fight', user='Neonesque', logic=SWORD, event=0x21, entities=[(6,1,31),(5,3,190),(2,5,31)], tiles=[37,-1,-1,199,-1,-1,199,-1,-1,38,-1,5,5,5,5,5,5,5,5,-1,-1,5,5,15,15,15,15,5,5,-1,-1,5,5,15,5,5,15,5,5,-1,-1,5,5,15,5,5,15,5,5,-1,-1,5,5,15,15,15,15,5,5,-1,-1,5,5,5,5,5,5,5,5,-1,39,-1,-1,200,-1,-1,200,-1,-1,40]), # 222
    RoomTemplate(name='Ball and Chain Encounter', user='Neonesque', logic=OR(SWORD,BOMB,BOW,BOOMERANG,HOOKSHOT,MAGIC_ROD), event=0x21, entities=[(7,2,81),(3,5,26),(6,6,26)], tiles=[37,-1,-1,-1,-1,33,33,33,33,38,-1,5,5,5,5,17,5,5,32,36,-1,5,32,32,5,5,5,5,5,36,-1,5,32,32,5,17,5,5,5,36,-1,5,32,32,5,21,19,5,19,36,-1,5,5,5,5,5,5,5,5,-1,-1,5,5,5,5,5,5,5,5,-1,39,-1,-1,-1,-1,-1,34,34,34,40]), # 223
    RoomTemplate(name='Bridge over large pit Horizontal ', user='TheRubyGemstone', tiles=[1,1,1,1,1,1,1,1,1,1,176,1,1,1,1,1,1,1,1,176,43,176,176,176,176,176,176,176,176,44,9,13,13,13,13,13,13,13,13,11,10,13,13,13,13,13,13,13,13,12,41,175,175,175,175,175,175,175,175,42,175,1,1,1,1,1,1,1,1,175,1,1,1,1,1,1,1,1,1,1]), # 225
    RoomTemplate(name='Bridge over Large pit Vertical', user='TheRubyGemstone', tiles=[1,1,1,42,67,68,41,1,1,1,1,1,1,175,5,5,175,1,1,1,1,1,1,1,5,5,1,1,1,1,1,1,1,1,5,5,1,1,1,1,1,1,1,1,5,5,1,1,1,1,1,1,1,1,5,5,1,1,1,1,1,1,1,176,5,5,176,1,1,1,1,1,1,44,140,8,43,1,1,1]), # 226
    RoomTemplate(name='Infested Storeroom', user='Neonesque', logic=POWER_BRACELET, event=0x61, entities=[(6,2,24),(2,3,24),(5,5,35)], tiles=[37,-1,-1,-1,-1,-1,-1,-1,-1,38,35,5,5,5,5,5,5,5,5,36,35,5,5,5,5,5,5,5,15,36,35,5,5,5,44,43,5,5,5,36,35,5,19,19,42,41,19,19,44,40,35,5,32,32,5,5,32,32,36,223,35,5,32,32,44,43,32,32,36,223,39,34,34,34,40,39,34,34,40,223]), # 227
    RoomTemplate(name='Eastern Palace boss room.', user='TheRubyGemstone', event=0x81, entities=[(2,2,136),(6,2,136)], tiles=[37,33,33,33,33,33,33,33,33,38,35,5,5,5,5,5,5,5,5,36,35,5,5,5,5,5,5,5,5,36,35,5,13,5,5,5,5,5,5,36,35,5,5,5,5,5,5,5,5,36,35,5,5,5,5,5,5,5,5,36,35,5,5,5,5,5,5,5,5,36,39,34,34,-1,-1,-1,-1,34,34,40]), # 229
    RoomTemplate(name='Moldorm Fakeout', user='TheRubyGemstone', event=0x21, entities=[(3,2,41),(4,2,41),(3,3,41),(4,3,41)], tiles=[37,33,33,-1,-1,-1,-1,33,33,38,35,175,174,15,15,15,15,174,175,36,35,1,15,15,15,15,15,15,1,36,35,1,15,15,15,15,15,15,1,36,35,1,15,15,15,15,15,15,1,36,35,1,15,15,15,15,15,15,1,36,35,176,174,15,15,15,15,174,176,36,39,34,34,-1,-1,-1,-1,34,34,40]), # 230
    RoomTemplate(name='Zora Shooting Range', user='le_becc', logic=OR(HOOKSHOT,BOOMERANG,MAGIC_ROD), event=0x21, entities=[(4,2,203),(8,3,203),(6,5,203)], tiles=[37,-1,-1,33,33,33,33,33,38,13,-1,5,5,14,14,14,14,14,42,38,-1,5,5,14,14,14,14,14,14,36,-1,5,5,14,14,14,14,14,14,36,-1,5,5,14,14,14,14,14,14,36,-1,5,5,14,14,14,14,14,14,36,-1,5,5,14,14,14,14,14,44,40,39,-1,-1,34,34,34,34,34,40,13]), # 231
    RoomTemplate(name='Shooting Fish in a Barrel', user='le_becc', logic=OR(BOOMERANG, MAGIC_ROD, BOW), event=0x21, entities=[(3,1,204),(7,2,204),(4,3,204)], tiles=[5,37,33,33,33,33,33,33,38,5,5,35,27,27,27,27,27,27,36,5,5,35,27,27,27,27,27,27,36,5,5,35,27,27,27,27,27,27,36,5,37,41,27,27,27,27,27,27,42,38,-1,13,18,18,18,18,18,18,13,-1,-1,13,13,13,13,13,13,13,13,-1,39,-1,-1,-1,-1,-1,-1,-1,-1,40]), # 232
    RoomTemplate(name='Corner Connector', user='le_becc', entities=[(2,3,9),(6,4,9)], tiles=[37,-1,-1,38,13,13,37,-1,-1,38,-1,5,5,42,38,37,41,5,5,-1,-1,5,5,32,42,41,32,5,5,-1,39,43,5,5,13,13,5,5,44,40,37,41,5,5,13,13,5,5,42,38,-1,5,5,32,44,43,32,5,5,-1,-1,5,5,44,40,39,43,5,5,-1,39,-1,-1,40,13,13,39,-1,-1,40]), # 234
    RoomTemplate(name='Slash-Jumps', user='le_becc', logic=AND(FEATHER, SWORD), tiles=[37,-1,-1,38,37,-1,-1,-1,-1,38,-1,5,5,42,41,221,221,5,5,-1,-1,5,221,175,174,174,175,44,34,40,-1,5,221,1,221,221,1,42,33,38,39,34,43,1,221,221,1,221,5,-1,37,33,41,176,174,174,176,221,5,-1,-1,5,5,221,221,44,43,5,5,-1,39,-1,-1,-1,-1,40,39,-1,-1,40]), # 237
    RoomTemplate(name='Easy to place room with no requirements and a chest', user='le_becc', entities=[(5,3,189)], tiles=[37,-1,-1,-1,-1,-1,-1,-1,-1,38,-1,5,5,5,5,5,5,5,5,-1,-1,5,192,160,192,192,192,192,5,-1,-1,5,192,7,7,7,7,192,5,-1,-1,5,192,7,7,7,7,192,5,-1,-1,5,172,192,7,7,192,172,5,-1,-1,5,5,5,5,5,5,5,5,-1,39,-1,-1,-1,-1,-1,-1,-1,-1,40]), # 238
]



class RoomConnection:
    def __init__(self, source, target):
        self.source = source
        self.target = target
        self.direction = None
        self.type = None
        self.offset = 0
        self.size = 2

    def set_type(self, value):
        self.type = value
        if value == 'bomb':
            self.size = 1
        elif value == 'big':
            self.size = 6
            self.type = 'opening'
        elif value == 'small':
            self.size = 3
            self.type = 'opening'
        else:
            self.size = 2

    def __repr__(self):
        return f"RC<:{self.source}->{self.target}:{self.direction}:{self.type}>"


class Room:
    def __init__(self, *, type="normal"):
        self.connections = []
        self.type = type
        self.x = None
        self.y = None
        self.source = None
        self.tiles = []
        self.entities = []
        self.room_id = None
        self.template = None

    def add_room(self, type="normal"):
        if len(self.connections) == 3:
            return None
        r = Room(type=type)
        self.connections.append(RoomConnection(self, r))
        r.source = self.connections[-1]
        return r

    def get_connection(self, direction):
        if self.source and self.source.direction == DIR_MIRROR[direction]:
            return self.source
        for c in self.connections:
            if c.direction == direction:
                return c
        return None

    @property
    def xy(self):
        return (self.x, self.y)

    def __repr__(self):
        return f"ROOM{{{self.x},{self.y}}}"

class Generator:
    ROOM_IDS_PER_MAP = {
        0x00: [n for n in range(0x101, 0x120)],
        0x01: [n for n in range(0x120, 0x140)],
        0x02: [n for n in range(0x140, 0x15D)],
        0x03: [n for n in range(0x160, 0x17E)],
        0x04: [n for n in range(0x180, 0x1AC)],
        0x05: [n for n in range(0x1B0, 0x1DE)],
        0x06: [n for n in range(0x201, 0x22F)],
        0x07: [n for n in range(0x230, 0x26C)],
        0x0A: [0x2B6, 0x2B7, 0x2B8, 0x2B9, 0x285, 0x286, 0x2F3, 0x2ED, 0x2EE, 0x2EA, 0x2EB, 0x2EC, 0x287, 0x2F1, 0x2F2, 0x2EF, 0x2BA, 0x2BB, 0x2BC, 0x28D, 0x2F9, 0x2FA, 0x280, 0x281, 0x282, 0x283, 0x284, 0x28C, 0x288, 0x28A, 0x290, 0x291, 0x292, 0x28E, 0x29A, 0x289, 0x28B]
    }

    def __init__(self, rng, map_id=0x0A):
        self.rng = rng
        self.map_id = map_id
        self.start = None
        self.end = None
        self.main_chain = []
        self.all_rooms = []

    def layout_map(self):
        self.start.x = 0
        self.start.y = 0
        min_x, max_x = 0, 0
        min_y, max_y = 0, 0
        room_map = {self.start.xy: self.start}
        todo = [self.start]
        while todo:
            r = todo.pop(0)
            dirs = ["up", "down", "left", "right"]
            self.rng.shuffle(dirs)
            for c in r.connections:
                while c.direction is None:
                    if not dirs:
                        raise CaveGenFailed("Cannot layout map")
                    c.direction = dirs.pop(0)
                    c.target.x = c.source.x + DIR_X[c.direction]
                    c.target.y = c.source.y + DIR_Y[c.direction]
                    if c.target.xy in room_map or abs(min_x - c.target.x) > 7 or abs(max_x - c.target.x) > 7 or abs(min_y - c.target.y) > 7 or abs(max_y - c.target.y) > 7:
                        c.direction = None
                    else:
                        min_x = min(min_x, c.target.x)
                        max_x = max(max_x, c.target.x)
                        min_y = min(min_y, c.target.y)
                        max_y = max(max_y, c.target.y)
                        room_map[c.target.xy] = c.target
                        todo.append(c.target)
        minx = min(xy[0] for xy in room_map)
        miny = min(xy[1] for xy in room_map)
        shiftx = -minx
        shifty = -miny
        for room in room_map.values():
            room.x += shiftx
            room.y += shifty

    def set_room_types(self):
        # First find end side rooms and turn those potentially in reward rooms
        for room in [room for room in self.all_rooms if not room.connections and room.type == "side"]:
            if self.rng.randrange(0, 100) < 80:
                room.type = "reward"
        # Next give each other room a 10% chance of having a reward
        for room in [room for room in self.all_rooms if room.type in {"side", "normal"}]:
            if self.rng.randrange(0, 100) < 15:
                room.type = "reward"

        # Set a template for each room
        for room in self.all_rooms:
            possible_templates = []
            for template in ROOM_TEMPLATES:
                if not template.match_room_type(room.type):
                    continue
                allowed = True
                for d in DIR_MIRROR.keys():
                    connection = room.get_connection(d)
                    open = connection is not None
                    if open:
                        if not template.can_be_open(d):
                            allowed = False
                        if connection.target == room:
                            if not template.can_be_connected_to(connection.source.template, d):
                                allowed = False
                    elif not template.can_be_closed(d):
                        allowed = False
                    
                if allowed:
                    possible_templates.append(template)
            if not possible_templates:
                print(room, room.type)
                print(room.source.source.template.name, room.source)
            room.template = self.rng.choice(possible_templates)
            if room.source:
                if room.source.type is None:
                    if room.source.source.template.event == 0x21 or room.template.event == 0x21:
                        room.source.set_type("door")
                    else:
                        room.source.set_type(self.rng.choice(["big", "small", "door", "bomb"]))
                    if room.source.type == "bomb" and room in self.main_chain and room.source.target in self.main_chain:
                        if self.rng.randrange(0, 100) < 70:
                            room.source.set_type(self.rng.choice(["big", "small", "door"]))
                options = room.template.possible_door_positions(room.source.source.template, DIR_MIRROR[room.source.direction], room.source.size)
                while not options:
                    room.source.size -= 1
                    assert room.source.size >= 1, room.template.name
                    options = room.template.possible_door_positions(room.source.source.template, DIR_MIRROR[room.source.direction], room.source.size)
                if room.source.size == 2:
                    room.source.type = "door"
                if room.source.size == 1:
                    if self.rng.randrange(0, 100) < 40:
                        room.source.type = "bomb"
                    else:
                        room.source.type = "opening"
                if len(options) == 1 and isinstance(options[0], tuple):
                    room.source.type = options[0][0]
                    room.source.offset = options[0][1]
                    room.source.size = options[0][2]
                else:
                    room.source.offset = self.rng.choice(options)

    def build_room_tiles(self, room):
        tiles = [TILE_FLOOR] * 10 * 8
        for n in range(10*8):
            tiles[n] = room.template.tiles[n]
        for d in DIR_MIRROR.keys():
            for n in TILE_CONNECTIONS[d]:
                if tiles[n] == -1:
                    tiles[n] = WALL_TILE[d]
            connection = room.get_connection(d)
            if connection:
                if connection.type == 'door':
                    if room.template.event == 0x21:
                        for idx in range(connection.size):
                            tiles[TILE_CONNECTIONS[d][idx+connection.offset]] = CLOSED_DOOR_TILES[d][idx]
                    else:
                        for idx in range(connection.size):
                            tiles[TILE_CONNECTIONS[d][idx+connection.offset]] = OPEN_DOOR_TILES[d][idx]
                elif connection.type == 'bomb':
                    for idx in range(connection.size):
                        tiles[TILE_CONNECTIONS[d][idx+connection.offset]] = BOMB_WALL_TILE[d]
                elif connection.type == 'opening':
                    for idx in range(connection.size):
                        tiles[TILE_CONNECTIONS[d][idx+connection.offset]] = TILE_FLOOR
                    if connection.size > 2:
                        tiles[TILE_CONNECTIONS[d][connection.offset]] = OPENING_TILES[d][0]
                        tiles[TILE_CONNECTIONS[d][connection.size+connection.offset-1]] = OPENING_TILES[d][1]
                else:
                    print(connection.type)

        for n in range(10*8):
            if tiles[n] == -1:
                tiles[n] = 1

        room.tiles = tiles
        if room.template.entities:
            room.entities = [(x, y, e) for x, y, e in room.template.entities]

    def get_reward_count(self) -> int:
        return sum(1 for room in self.all_rooms if room.type in {"reward"})

    def get_logic_requirements(self, inventory):
        result = set()
        for room in self.all_rooms:
            if room.template.logic is None:
                continue
            if isinstance(room.template.logic, str):
                if room.template.logic not in inventory:
                    result.add(room.template.logic)
            else:
                room.template.logic.getItems(inventory, result)
        return result

    def generate(self):
        for n in range(100):
            try:
                return self._generate()
            except CaveGenFailed:
                pass
        raise CaveGenFailed("Failed after 100 tries")

    def _generate(self):
        self.start = Room(type="start")
        self.end = self.start
        self.main_chain = [self.start]
        self.all_rooms = [self.start]
        # for n in range(self.rng.randint(4, 6)):
        for n in range(self.rng.randint(12, 18)):
            self.end = self.end.add_room()
            self.main_chain.append(self.end)
            self.all_rooms.append(self.end)
        side_room = None
        # side_room_count = min(self.rng.randint(8, 11) - len(self.main_chain), 5)
        side_room_count = min(self.rng.randint(20, 31) - len(self.main_chain), 16)
        for n in range(side_room_count):
            if side_room is None or self.rng.randrange(0, 100) < 50:
                side_room = self.all_rooms[self.rng.randint(0, len(self.all_rooms) - 1)].add_room("side")
            else:
                side_room = side_room.add_room("side")
            if side_room is not None:
                self.all_rooms.append(side_room)
        self.end.type = "end"
        self.layout_map()
        self.set_room_types()
        cave_room_ids = self.ROOM_IDS_PER_MAP[self.map_id].copy()
        for room in self.all_rooms:
            room.room_id = cave_room_ids.pop()
            self.build_room_tiles(room)
        return self.start


class CaveGenFailed(Exception):
    pass


def dump(filename, *gens):
    f = open(filename, "wt")
    scale = 40
    row_width = math.ceil(math.sqrt(len(gens)))
    rows = (len(gens) + row_width - 1) // row_width
    f.write(f'<svg xmlns="http://www.w3.org/2000/svg" width="{row_width*scale*8}" height="{rows*scale*8}">')
    for gen_idx, gen in enumerate(gens):
        f.write(f'<g transform="scale({scale} {scale}) translate({(gen_idx%row_width)*8} {(gen_idx//row_width)*8})">')
        def dumpRoom(r):
            for c in r.connections:
                col = "#000"
                if c.type == "bomb":
                    col = "#F00"
                f.write(f'<line x1="{r.x+.4}" y1="{r.y+.4}" x2="{c.target.x+.4}" y2="{c.target.y+.4}" stroke="{col}" stroke-width="0.1" />')
                dumpRoom(c.target)
            col = "#FFF"
            if r.type == "start":
                col = "#F88"
            if r.type == "end":
                col = "#8F8"
            if r.type == "side" or r not in gen.main_chain:
                col = "#88F"
            if r.type in {"chest", "item"}:
                col = "#8FF"
            f.write(f'<rect x="{r.x}" y="{r.y}" width="0.8" height="0.8" fill="{col}" stroke="#000" stroke-width="0.1" />')
            f.write(f'<text x="{r.x+.1}" y="{r.y+.3}" alignment-baseline="hanging" font-size="0.2">{r.type}</text>')
        dumpRoom(gen.start)
        f.write("</g>")
    f.write("</svg>")
    f.close()


def main(argv):
    import romTables
    from roomEditor import RoomEditor
    import random
    import mapexport
    import randomizer
    import generator
    import patches.aesthetics
    import patches.enemies
    import argparse
    from assembler import ASM

    parser = argparse.ArgumentParser()
    parser.add_argument('-i', '--inout', dest="input_filename", metavar='input rom', type=str, help="Rom file to use as input.", required=False)
    parser.add_argument('-o', '--output', dest="output_filename", metavar='output rom', type=str, help="Store generated test rom", required=False)
    parser.add_argument('-r', '--room', dest="room_data", metavar='room data', type=str, help="JSON string with DRD room data, to generate single test room rom", required=False)
    parser.add_argument('-m', '--map', dest="map_export", action="store_true", help="Export full map data")
    parser.add_argument('--svg', dest="svg", metavar="layout svg", type=str, help="Location to store output SVG for room layout", required=False)
    parser.add_argument('--layout-count', dest="layout_count", metavar="layout count", type=int, help="Amount of room layouts to generate", default=0, required=False)
    args = parser.parse_args(argv)

    rng = random.Random()
    gen = Generator(rng)
    cave = gen.generate()
    if args.svg:
        if args.layout_count:
            gens = []
            for n in range(args.layout_count):
                print(n)
                g = Generator(rng)
                g.generate()
                gens.append(g)
            dump(args.svg, *gens)
        else:
            dump(args.svg, gen)

    if args.input_filename:
        rom = romTables.ROMWithTables(open(args.input_filename, "rb"))
        rom.patch(0, 0x0003, "00", "01")
        generator.romCorePatches(rom)
        patches.enemies.changeMiniBosses(rom, {})
        # Debug save start room
        rom.patch(0x01, 0x0758, 0x076D, ASM("""
            ld hl, $A464
            ld a, $01
            ld [hl+], a ; wSpawnIsIndoor
            ld a, $10
            ld [hl+], a ; wSpawnMapId
            ld a, $A3
            ld [hl+], a ; wSpawnMapRoom
            ld a, $50
            ld [hl+], a ; wSpawnPositionX
            ld a, $7F
            ld [hl+], a ; wSpawnPositionY
        """), fill_nop=True)
        re = RoomEditor(rom, 0x2A3)
        warp = re.getWarps()[0]
        warp.warp_type = 1
        warp.room = 0x28B
        warp.map_nr = gen.map_id
        warp.target_x = 0x48
        warp.target_y = 0x50
        re.store(rom)

        # Fix tile attributes for bombable walls
        rom.patch(0x24, 0x0400 + 0x3F * 4, "00000000040404040000000000000000", "04040404040404040404040404040404")
        rom.patch(0x24, 0x0400 + 0x93 * 4, "00000000000000000000000000000000", "01050505050105050505010505050501")  # single tile corners
        rom.patch(0x24, 0x0400 + 0xCE * 4, "07070707", "04040404")  # Small table
        for x in range(8):
            for y in range(8):
                rom.banks[0x14][0x0220 + gen.map_id * 8*8 + x + y * 8] = 0
        cave_room_ids = [0x2B6, 0x2B7, 0x2B8, 0x2B9, 0x285, 0x286, 0x2F3, 0x2ED, 0x2EE, 0x2EA, 0x2EB, 0x2EC, 0x287, 0x2F1, 0x2F2, 0x2EF, 0x2BA, 0x2BB, 0x2BC, 0x28D, 0x2F9, 0x2FA, 0x280, 0x281, 0x282, 0x283, 0x284, 0x28C, 0x288, 0x28A, 0x290, 0x291, 0x292, 0x28E, 0x29A, 0x289, 0x28B]
        def place(room):
            room_id = cave_room_ids.pop()
            print(hex(room_id), room.type)
            rom.banks[0x14][0x0220 + gen.map_id * 8*8 + room.x + room.y * 8] = room_id & 0xFF
            re = RoomEditor(rom, room_id)
            re.entities = room.entities
            re.buildObjectList(room.tiles)
            for t in room.tiles:
                if t in TILE_TILESETS:
                    rom.banks[0x20][0x2eB3 + room_id - 0x100] = TILE_TILESETS[t][0]
                if t in TILE_ANIMATION_SET:
                    re.animation_id = TILE_ANIMATION_SET[t][0]
            re.store(rom)
            for c in room.connections:
                place(c.target)
        place(cave)

        if args.room_data:
            import json
            data = json.loads(args.room_data)
            for n in range(0x200, 0x2FF):
                if n == 0x2A3:
                    continue
                re = RoomEditor(rom, n)
                re.buildObjectList([5] * 8 * 10)
                re.entities = []
                re.store(rom)
            re = RoomEditor(rom, 0x28B)
            re.buildObjectList([n if n != -1 else 2 for n in data['tiles']])
            if 'entities' in data:
                re.entities = data['entities']
            re.store(rom)
            rom.banks[0x14][0x0000 + 0x28B - 0x100] = int(data.get("event", "0"), 0)

        for ri in cave_room_ids:
            re = RoomEditor(rom, ri)
            re.entities = []
            re.objects = []
            re.store(rom)
        
        if args.map_export:
            mapexport.MapExport(rom).export_all(specific_dungeon=gen.map_id)
        patches.aesthetics.updateSpriteData(rom)
        if args.output_filename:
            rom.save(args.output_filename, name="LADXR")


if __name__ == "__main__":
    import sys
    main(sys.argv[1:])
